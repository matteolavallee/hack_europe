[{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\calendar\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedDate' is defined but never used.","line":176,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":176,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useMemo } from \"react\"\r\nimport {\r\n  Mic,\r\n  CalendarPlus,\r\n  Calendar as CalendarIcon,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Pill,\r\n  Stethoscope,\r\n  Users,\r\n  MessageCircle,\r\n  Check,\r\n  Clock,\r\n  Send,\r\n  Trash2,\r\n} from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/Button\"\r\nimport { SeniorCareCalendar } from \"@/components/ui/SeniorCareCalendar\"\r\nimport { Modal } from \"@/components/ui/Modal\"\r\nimport { Input, Select, Textarea } from \"@/components/ui/Input\"\r\nimport { cn, formatTime } from \"@/lib/utils\"\r\nimport { useCalendarItems } from \"@/hooks/useCalendarItems\"\r\nimport { createCalendarItem, sendVoiceMessageNow, triggerCalendarItemNow, deleteCalendarItem, CARE_RECEIVER_ID } from \"@/lib/api\"\r\nimport type { CalendarItem, CalendarItemType } from \"@/lib/types\"\r\n\r\n// ÔöÇÔöÇÔöÇ Types & Mock data ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nexport type EventCategory = \"medication\" | \"appointment\" | \"visit\" | \"voice_message\" | \"whatsapp_message\"\r\n\r\n\r\nexport interface TimelineEvent {\r\n  id: string\r\n  title: string\r\n  subtitle?: string\r\n  time: string // \"HH:mm\"\r\n  category: EventCategory\r\n  isDone?: boolean // for past events: sent/done\r\n}\r\n\r\nfunction getTodayDateString(): string {\r\n  const d = new Date()\r\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`\r\n}\r\n\r\nfunction addDays(dateStr: string, delta: number): string {\r\n  const d = new Date(dateStr + \"T12:00:00\")\r\n  d.setDate(d.getDate() + delta)\r\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`\r\n}\r\n\r\nfunction isToday(dateStr: string): boolean {\r\n  return dateStr === getTodayDateString()\r\n}\r\n\r\nfunction formatDayLabel(dateStr: string): string {\r\n  if (isToday(dateStr)) return \"Today\"\r\n  const d = new Date(dateStr + \"T12:00:00\")\r\n  const yesterday = addDays(getTodayDateString(), -1)\r\n  const tomorrow = addDays(getTodayDateString(), 1)\r\n  if (dateStr === yesterday) return \"Yesterday\"\r\n  if (dateStr === tomorrow) return \"Tomorrow\"\r\n  return d.toLocaleDateString(\"en-GB\", { weekday: \"short\", day: \"numeric\", month: \"short\" })\r\n}\r\n\r\nfunction formatLongDate(dateStr: string): string {\r\n  return new Date(dateStr + \"T12:00:00\").toLocaleDateString(\"en-GB\", {\r\n    weekday: \"long\",\r\n    day: \"numeric\",\r\n    month: \"long\",\r\n  })\r\n}\r\n\r\n// Map API CalendarItem to timeline event for display; parse category from message_text prefix [medication] etc.\r\nfunction calendarItemToTimelineEvent(item: CalendarItem): TimelineEvent {\r\n  let category: EventCategory = \"voice_message\"\r\n  let subtitle: string | undefined = item.message_text\r\n  if (item.message_text) {\r\n    const match = item.message_text.match(/^\\[(medication|appointment|visit|voice_message)\\]\\s*/i)\r\n    if (match) {\r\n      category = match[1].toLowerCase() as EventCategory\r\n      subtitle = item.message_text.slice(match[0].length).trim() || undefined\r\n    }\r\n  }\r\n  if (item.type === \"audio_push\") category = \"voice_message\"\r\n  if (item.type === \"whatsapp_prompt\") category = \"whatsapp_message\"\r\n  const time = formatTime(item.scheduled_at)\r\n  const isDone = item.status !== \"scheduled\"\r\n  return {\r\n    id: item.id,\r\n    title: item.title,\r\n    subtitle,\r\n    time,\r\n    category,\r\n    isDone,\r\n  }\r\n}\r\n\r\nfunction getDateFromScheduledAt(iso: string): string {\r\n  return new Date(iso).toLocaleDateString(\"en-CA\", { year: \"numeric\", month: \"2-digit\", day: \"2-digit\" })\r\n}\r\n\r\n/* High contrast ÔÇö AAA WCAG, semantic colors with icons/labels */\r\nconst CATEGORY_CONFIG: Record<\r\n  EventCategory,\r\n  { label: string; icon: typeof Pill; bg: string; border: string; iconBg: string; text: string }\r\n> = {\r\n  medication: {\r\n    label: \"Medication\",\r\n    icon: Pill,\r\n    bg: \"bg-[#FEE2E2]\",\r\n    border: \"border-2 border-destructive/50\",\r\n    iconBg: \"bg-[#FCA5A5] text-[#991B1B]\",\r\n    text: \"text-[#7F1D1D]\",\r\n  },\r\n  appointment: {\r\n    label: \"Medical appointment\",\r\n    icon: Stethoscope,\r\n    bg: \"bg-[#DBEAFE]\",\r\n    border: \"border-2 border-[#2563EB]/50\",\r\n    iconBg: \"bg-[#93C5FD] text-[#1E3A8A]\",\r\n    text: \"text-[#1E3A8A]\",\r\n  },\r\n  visit: {\r\n    label: \"Visit\",\r\n    icon: Users,\r\n    bg: \"bg-[#DCFCE7]\",\r\n    border: \"border-2 border-primary/50\",\r\n    iconBg: \"bg-[#86EFAC] text-[#166534]\",\r\n    text: \"text-[#166534]\",\r\n  },\r\n  voice_message: {\r\n    label: \"Voice message\",\r\n    icon: MessageCircle,\r\n    bg: \"bg-[#EDE9FE]\",\r\n    border: \"border-2 border-[#6D28D9]/50\",\r\n    iconBg: \"bg-[#C4B5FD] text-[#4C1D95]\",\r\n    text: \"text-[#4C1D95]\",\r\n  },\r\n  whatsapp_message: {\r\n    label: \"Message WhatsApp\",\r\n    icon: MessageCircle,\r\n    bg: \"bg-[#DCFCE7]\",\r\n    border: \"border-2 border-[#22C55E]/50\",\r\n    iconBg: \"bg-[#86EFAC] text-[#166534]\",\r\n    text: \"text-[#166534]\",\r\n  },\r\n}\r\n\r\n// Current time for displayed day: real if today, else noon for demo\r\nfunction getNowTimeForDay(selectedDate: string): { hour: number; minute: number } {\r\n  if (isToday(selectedDate)) {\r\n    const now = new Date()\r\n    return { hour: now.getHours(), minute: now.getMinutes() }\r\n  }\r\n  return { hour: 12, minute: 0 }\r\n}\r\n\r\nfunction isEventPast(eventTime: string, selectedDate: string): boolean {\r\n  const [h, m] = eventTime.split(\":\").map(Number)\r\n  const { hour, minute } = getNowTimeForDay(selectedDate)\r\n  return h < hour || (h === hour && m <= minute)\r\n}\r\n\r\nfunction formatCurrentTime(selectedDate: string): string {\r\n  const { hour, minute } = getNowTimeForDay(selectedDate)\r\n  return `${String(hour).padStart(2, \"0\")}:${String(minute).padStart(2, \"0\")}`\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Composant Timeline ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction TimelineEventCard({\r\n  event,\r\n  isPast,\r\n  selectedDate,\r\n  onTriggerNow,\r\n  onDelete,\r\n  isTriggering,\r\n}: {\r\n  event: TimelineEvent\r\n  isPast: boolean\r\n  selectedDate: string\r\n  onTriggerNow?: (eventId: string) => void\r\n  onDelete?: (eventId: string) => void\r\n  isTriggering?: boolean\r\n}) {\r\n  const config = CATEGORY_CONFIG[event.category]\r\n  const Icon = config.icon\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex gap-3 rounded-lg border border-border bg-card p-4\",\r\n        isPast && \"opacity-70\",\r\n      )}\r\n    >\r\n      <div className={cn(\"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg\", config.iconBg)}>\r\n        <Icon className=\"h-4 w-4\" aria-hidden />\r\n      </div>\r\n      <div className=\"min-w-0 flex-1\">\r\n        <p className={cn(\"text-sm font-medium\", config.text)}>{event.title}</p>\r\n        {event.subtitle && <p className=\"mt-0.5 text-xs text-muted-foreground\">{event.subtitle}</p>}\r\n        <div className=\"mt-2 flex flex-wrap items-center gap-2\">\r\n          <span className=\"text-xs font-medium text-muted-foreground\">{event.time}</span>\r\n          {isPast ? (\r\n            <span className=\"inline-flex items-center gap-1 rounded bg-muted px-2 py-0.5 text-xs font-medium text-foreground\">\r\n              <Check className=\"h-3 w-3\" aria-hidden /> Sent\r\n            </span>\r\n          ) : (\r\n            <span className=\"inline-flex items-center gap-1 rounded bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary\">\r\n              <Clock className=\"h-3 w-3\" aria-hidden /> Upcoming\r\n            </span>\r\n          )}\r\n          <div className=\"ml-auto flex shrink-0 items-center gap-1\">\r\n            {onTriggerNow && (\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                disabled={isTriggering}\r\n                onClick={(e) => {\r\n                  e.stopPropagation()\r\n                  onTriggerNow(event.id)\r\n                }}\r\n                aria-label={`Send ${event.title} now to device`}\r\n              >\r\n                {isTriggering ? (\r\n                  <span className=\"text-xs\">EnvoiÔÇª</span>\r\n                ) : (\r\n                  <>\r\n                    <Send className=\"h-3.5 w-3.5\" aria-hidden />\r\n                    Send now\r\n                  </>\r\n                )}\r\n              </Button>\r\n            )}\r\n            {onDelete && (\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"text-destructive hover:bg-destructive/10 hover:text-destructive\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation()\r\n                  onDelete(event.id)\r\n                }}\r\n                aria-label={`Delete ${event.title}`}\r\n              >\r\n                <Trash2 className=\"h-3.5 w-3.5\" aria-hidden />\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Page ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\ntype RepeatRule = \"none\" | \"daily\" | \"weekly\" | \"monthly\" | \"custom\"\r\n\r\nconst WEEKDAYS: { value: string; label: string }[] = [\r\n  { value: \"0\", label: \"Sunday\" },\r\n  { value: \"1\", label: \"Monday\" },\r\n  { value: \"2\", label: \"Tuesday\" },\r\n  { value: \"3\", label: \"Wednesday\" },\r\n  { value: \"4\", label: \"Thursday\" },\r\n  { value: \"5\", label: \"Friday\" },\r\n  { value: \"6\", label: \"Saturday\" },\r\n]\r\n\r\nconst MONTHLY_OCCURRENCES: { value: string; label: string }[] = [\r\n  { value: \"1\", label: \"First\" },\r\n  { value: \"2\", label: \"Second\" },\r\n  { value: \"3\", label: \"Third\" },\r\n  { value: \"4\", label: \"Fourth\" },\r\n  { value: \"last\", label: \"Last\" },\r\n]\r\n\r\nfunction getDefaultReminderDate(): string {\r\n  return getTodayDateString()\r\n}\r\n\r\nfunction getDefaultReminderTime(): string {\r\n  const now = new Date()\r\n  const h = now.getHours()\r\n  const m = now.getMinutes()\r\n  return `${String(h).padStart(2, \"0\")}:${String(m).padStart(2, \"0\")}`\r\n}\r\n\r\ntype CalendarView = \"timeline\" | \"calendar\"\r\n\r\nexport default function CalendarPage() {\r\n  const { items, loading, refresh } = useCalendarItems()\r\n  const [view, setView] = useState<CalendarView>(\"calendar\")\r\n  const [selectedDate, setSelectedDate] = useState(getTodayDateString())\r\n  const [voiceModalOpen, setVoiceModalOpen] = useState(false)\r\n  const [reminderModalOpen, setReminderModalOpen] = useState(false)\r\n  const [voiceMessage, setVoiceMessage] = useState(\"\")\r\n  const [voiceSenderName, setVoiceSenderName] = useState(\"\")\r\n  const [voiceSendMode, setVoiceSendMode] = useState<\"now\" | \"scheduled\">(\"now\")\r\n  const [voiceScheduleDate, setVoiceScheduleDate] = useState(() => getDefaultReminderDate())\r\n  const [voiceScheduleTime, setVoiceScheduleTime] = useState(() => getDefaultReminderTime())\r\n  const [voiceSending, setVoiceSending] = useState(false)\r\n  const [submitting, setSubmitting] = useState(false)\r\n  const [triggeringId, setTriggeringId] = useState<string | null>(null)\r\n  const [sendFeedback, setSendFeedback] = useState<\"success\" | \"error\" | null>(null)\r\n\r\n  // Reminder form state\r\n  const [reminderDate, setReminderDate] = useState(() => getDefaultReminderDate())\r\n  const [reminderTitle, setReminderTitle] = useState(\"\")\r\n  const [reminderType, setReminderType] = useState<EventCategory>(\"medication\")\r\n  const [reminderTime, setReminderTime] = useState(() => getDefaultReminderTime())\r\n  const [reminderMessage, setReminderMessage] = useState(\"\")\r\n  const [repeatRule, setRepeatRule] = useState<RepeatRule>(\"none\")\r\n  const [repeatOnDay, setRepeatOnDay] = useState<string>(\"2\") // Tuesday by default for \"weekly\"\r\n  const [repeatInterval, setRepeatInterval] = useState(1) // every 1 day/week/month\r\n  const [monthlyKind, setMonthlyKind] = useState<\"same_date\" | \"same_weekday\">(\"same_date\")\r\n  const [monthlyOccurrence, setMonthlyOccurrence] = useState<string>(\"1\") // first, second, ... last\r\n  const [customRepeatDays, setCustomRepeatDays] = useState(2) // for \"custom\": every X days\r\n\r\n  const nowTime = formatCurrentTime(selectedDate)\r\n  const showNowSeparator = isToday(selectedDate)\r\n\r\n  const eventsForDay = useMemo(() => {\r\n    const dayEvents = items\r\n      .filter((item) => getDateFromScheduledAt(item.scheduled_at) === selectedDate)\r\n      .map(calendarItemToTimelineEvent)\r\n      .sort((a, b) => a.time.localeCompare(b.time))\r\n    return dayEvents\r\n  }, [items, selectedDate])\r\n\r\n  const { pastEvents, futureEvents } = useMemo(() => {\r\n    const past: TimelineEvent[] = []\r\n    const future: TimelineEvent[] = []\r\n    for (const e of eventsForDay) {\r\n      if (isEventPast(e.time, selectedDate)) past.push(e)\r\n      else future.push(e)\r\n    }\r\n    return { pastEvents: past, futureEvents: future }\r\n  }, [eventsForDay, selectedDate])\r\n\r\n  const goPrev = () => setSelectedDate((d) => addDays(d, -1))\r\n  const goNext = () => setSelectedDate((d) => addDays(d, 1))\r\n  const goToday = () => setSelectedDate(getTodayDateString())\r\n\r\n  function buildRepeatRuleString(): string | undefined {\r\n    if (repeatRule === \"none\") return undefined\r\n    if (repeatRule === \"daily\") return repeatInterval === 1 ? \"daily\" : `daily:${repeatInterval}`\r\n    if (repeatRule === \"weekly\") return repeatInterval === 1 ? `weekly:${repeatOnDay}` : `weekly:${repeatOnDay}:${repeatInterval}`\r\n    if (repeatRule === \"monthly\") {\r\n      if (monthlyKind === \"same_date\") return repeatInterval === 1 ? \"monthly\" : `monthly:${repeatInterval}`\r\n      return `monthly:same_weekday:${monthlyOccurrence}:${repeatOnDay}`\r\n    }\r\n    if (repeatRule === \"custom\") return `custom:${customRepeatDays}`\r\n    return undefined\r\n  }\r\n\r\n  function resetReminderForm() {\r\n    setReminderDate(getDefaultReminderDate())\r\n    setReminderTitle(\"\")\r\n    setReminderType(\"medication\")\r\n    setReminderTime(getDefaultReminderTime())\r\n    setReminderMessage(\"\")\r\n    setRepeatRule(\"none\")\r\n    setRepeatOnDay(\"2\")\r\n    setRepeatInterval(1)\r\n    setMonthlyKind(\"same_date\")\r\n    setMonthlyOccurrence(\"1\")\r\n    setCustomRepeatDays(2)\r\n  }\r\n\r\n  async function handleTriggerNow(eventId: string) {\r\n    setTriggeringId(eventId)\r\n    setSendFeedback(null)\r\n    try {\r\n      await triggerCalendarItemNow(eventId, CARE_RECEIVER_ID)\r\n      await refresh()\r\n      setSendFeedback(\"success\")\r\n      setTimeout(() => setSendFeedback(null), 4000)\r\n    } catch (err) {\r\n      setSendFeedback(\"error\")\r\n      setTimeout(() => setSendFeedback(null), 4000)\r\n      console.error(\"Send now failed:\", err)\r\n    } finally {\r\n      setTriggeringId(null)\r\n    }\r\n  }\r\n\r\n  async function handleDelete(eventId: string) {\r\n    try {\r\n      await deleteCalendarItem(eventId)\r\n      await refresh()\r\n    } catch {\r\n      // Error feedback could be added\r\n    }\r\n  }\r\n\r\n  async function handleCreateReminder() {\r\n    const title = reminderTitle.trim()\r\n    if (!title) return\r\n    setSubmitting(true)\r\n    try {\r\n      const scheduledAt = new Date(`${reminderDate}T${reminderTime}:00`).toISOString()\r\n      const messageText = `[${reminderType}] ${reminderMessage.trim()}`.trim()\r\n      const repeat_rule = buildRepeatRuleString()\r\n      const itemType: CalendarItemType = reminderType === \"whatsapp_message\" ? \"whatsapp_prompt\" : \"reminder\"\r\n      await createCalendarItem({\r\n        care_receiver_id: CARE_RECEIVER_ID,\r\n        type: itemType,\r\n        title,\r\n        message_text: messageText || undefined,\r\n        scheduled_at: scheduledAt,\r\n        repeat_rule,\r\n      })\r\n      await refresh()\r\n      setReminderModalOpen(false)\r\n      resetReminderForm()\r\n    } finally {\r\n      setSubmitting(false)\r\n    }\r\n  }\r\n\r\n  function closeVoiceModal() {\r\n    setVoiceModalOpen(false)\r\n    setVoiceMessage(\"\")\r\n    setVoiceSenderName(\"\")\r\n    setVoiceSendMode(\"now\")\r\n    setVoiceScheduleDate(getDefaultReminderDate())\r\n    setVoiceScheduleTime(getDefaultReminderTime())\r\n  }\r\n\r\n  async function handleSendVoiceMessage() {\r\n    const sender = voiceSenderName.trim() || \"A family member\"\r\n    const message = voiceMessage.trim()\r\n    if (!message) return\r\n    setVoiceSending(true)\r\n    try {\r\n      if (voiceSendMode === \"now\") {\r\n        await sendVoiceMessageNow(CARE_RECEIVER_ID, sender, message)\r\n        closeVoiceModal()\r\n        return\r\n      }\r\n      const scheduledAt = new Date(`${voiceScheduleDate}T${voiceScheduleTime}:00`).toISOString()\r\n      const messageText = `[voice_message] From ${sender}: ${message}`\r\n      await createCalendarItem({\r\n        care_receiver_id: CARE_RECEIVER_ID,\r\n        type: \"reminder\",\r\n        title: `Voice message from ${sender}`,\r\n        message_text: messageText,\r\n        scheduled_at: scheduledAt,\r\n      })\r\n      await refresh()\r\n      closeVoiceModal()\r\n    } finally {\r\n      setVoiceSending(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background pb-6\">\r\n      <div className=\"sticky top-0 z-10 flex flex-col gap-3 border-b border-border bg-background px-4 py-3 sm:flex-row sm:items-center sm:justify-between sm:px-6\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <h1 className=\"text-xl font-semibold text-foreground\">Calendar & Alerts</h1>\r\n          {view === \"calendar\" && (\r\n            <div className=\"hidden gap-2 sm:flex\">\r\n              <Button size=\"sm\" variant=\"secondary\" onClick={() => setVoiceModalOpen(true)}>\r\n                <Mic className=\"h-4 w-4 shrink-0\" aria-hidden />\r\n                Voice\r\n              </Button>\r\n              <Button size=\"sm\" variant=\"primary\" onClick={() => setReminderModalOpen(true)}>\r\n                <CalendarPlus className=\"h-4 w-4 shrink-0\" aria-hidden />\r\n                Reminder\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"flex rounded-lg border border-border p-1 bg-muted/50\">\r\n          <button\r\n            onClick={() => setView(\"calendar\")}\r\n            className={cn(\r\n              \"h-[44px] min-w-[80px] rounded-md px-3 text-sm font-medium transition-colors\",\r\n              view === \"calendar\" ? \"bg-primary text-primary-foreground shadow-sm\" : \"text-muted-foreground hover:text-foreground hover:bg-muted\"\r\n            )}\r\n            aria-pressed={view === \"calendar\"}\r\n            aria-label=\"Grid view\"\r\n          >\r\n            Grid\r\n          </button>\r\n          <button\r\n            onClick={() => setView(\"timeline\")}\r\n            className={cn(\r\n              \"h-[44px] min-w-[80px] rounded-md px-3 text-sm font-medium transition-colors\",\r\n              view === \"timeline\" ? \"bg-primary text-primary-foreground shadow-sm\" : \"text-muted-foreground hover:text-foreground hover:bg-muted\"\r\n            )}\r\n            aria-pressed={view === \"timeline\"}\r\n            aria-label=\"Timeline view\"\r\n          >\r\n            Timeline\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {view === \"calendar\" ? (\r\n        <SeniorCareCalendar className=\"min-h-[calc(100vh-6rem)]\" />\r\n      ) : (\r\n      <div className=\"mx-auto max-w-2xl px-4 pt-6 sm:px-6\">\r\n        <header className=\"mb-5\">\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            {formatLongDate(selectedDate)}\r\n          </p>\r\n\r\n          <div className=\"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2\">\r\n            <Button\r\n              size=\"md\"\r\n              variant=\"secondary\"\r\n              className=\"w-full\"\r\n              onClick={() => setVoiceModalOpen(true)}\r\n            >\r\n              <Mic className=\"h-4 w-4 shrink-0\" aria-hidden />\r\n              Direct voice message\r\n            </Button>\r\n            <Button\r\n              size=\"md\"\r\n              variant=\"primary\"\r\n              className=\"w-full\"\r\n              onClick={() => setReminderModalOpen(true)}\r\n            >\r\n              <CalendarPlus className=\"h-4 w-4 shrink-0\" aria-hidden />\r\n              Schedule a reminder\r\n            </Button>\r\n          </div>\r\n        </header>\r\n\r\n        <div className=\"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n          <label className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\r\n            <CalendarIcon className=\"h-4 w-4 text-muted-foreground\" aria-hidden />\r\n            <span className=\"hidden sm:inline\">Go to date:</span>\r\n            <input\r\n              type=\"date\"\r\n              value={selectedDate}\r\n              onChange={(e) => setSelectedDate(e.target.value)}\r\n              className=\"h-9 rounded-lg border border-input px-3 py-2 text-sm text-foreground focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20\"\r\n            />\r\n          </label>\r\n          <nav className=\"flex items-center justify-center gap-1 rounded-lg border border-border bg-card p-2 sm:gap-2\">\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedDate((d) => addDays(d, -7))} className=\"shrink-0 gap-1\" title=\"Previous week\">\r\n              <ChevronLeft className=\"h-4 w-4\" aria-hidden /> <span className=\"hidden sm:inline\">Week</span>\r\n            </Button>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={goPrev} className=\"shrink-0 gap-1\" title=\"Previous day\">\r\n              <ChevronLeft className=\"h-4 w-4\" aria-hidden />\r\n            </Button>\r\n            <div\r\n              className={cn(\r\n                \"flex min-w-0 max-w-[120px] shrink flex-col items-center justify-center overflow-hidden rounded-lg px-4 py-3 text-center sm:max-w-[140px]\",\r\n                isToday(selectedDate)\r\n                  ? \"bg-primary text-primary-foreground\"\r\n                  : \"bg-muted text-foreground\",\r\n              )}\r\n              aria-live=\"polite\"\r\n              aria-label={`Viewing ${formatDayLabel(selectedDate)}`}\r\n              title={formatDayLabel(selectedDate)}\r\n            >\r\n              <span className=\"w-full truncate text-[10px] font-medium uppercase tracking-wider opacity-80\">\r\n                Viewing\r\n              </span>\r\n              <span className=\"mt-0.5 w-full truncate text-sm font-semibold sm:text-base\">\r\n                {formatDayLabel(selectedDate)}\r\n              </span>\r\n              {!isToday(selectedDate) && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={goToday}\r\n                  className=\"mt-2 shrink-0 text-xs font-medium underline hover:no-underline\"\r\n                  aria-label=\"Go to today\"\r\n                >\r\n                  Go to today\r\n                </button>\r\n              )}\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={goNext} className=\"shrink-0 gap-1\" title=\"Next day\">\r\n              <ChevronRight className=\"h-4 w-4\" aria-hidden />\r\n            </Button>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedDate((d) => addDays(d, 7))} className=\"shrink-0 gap-1\" title=\"Next week\">\r\n              <span className=\"hidden sm:inline\">Week</span> <ChevronRight className=\"h-4 w-4\" aria-hidden />\r\n            </Button>\r\n          </nav>\r\n        </div>\r\n\r\n        {/* Feedback Send now */}\r\n        {sendFeedback === \"success\" && (\r\n          <div className=\"mb-4 rounded-lg border border-primary/30 bg-primary/10 px-4 py-3 text-sm text-foreground\">\r\n            <span className=\"font-medium\">Rappel envoy├® au device.</span>{\" \"}\r\n            <a href=\"/device\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline hover:no-underline\">\r\n              Ouvrez la vue Device Ôåù\r\n            </a>{\" \"}\r\n            pour l&apos;├®couter.\r\n          </div>\r\n        )}\r\n        {sendFeedback === \"error\" && (\r\n          <div className=\"mb-4 rounded-lg border border-destructive/30 bg-destructive/10 px-4 py-3 text-sm text-destructive\">\r\n            ├ëchec de l&apos;envoi. V├®rifiez que le backend tourne sur {process.env.NEXT_PUBLIC_API_URL ?? \"localhost:8000\"}.\r\n          </div>\r\n        )}\r\n\r\n        {/* Timeline */}\r\n        <div className=\"relative\">\r\n          <div className=\"absolute left-4 top-0 bottom-0 w-px bg-border sm:left-5\" aria-hidden />\r\n\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-16\">\r\n              <svg className=\"h-10 w-10 animate-spin text-primary\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden>\r\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8v8H4z\" />\r\n              </svg>\r\n            </div>\r\n          ) : (\r\n          <div className=\"space-y-6\">\r\n            {/* Past events */}\r\n            {pastEvents.map((event) => (\r\n              <div key={event.id} className=\"relative flex gap-4 pl-2 sm:pl-3\">\r\n                <div className=\"absolute left-0 top-6 h-4 w-4 shrink-0 rounded-full bg-muted-foreground sm:left-1\" aria-hidden />\r\n                <div className=\"flex-1 pt-0\">\r\n                  <TimelineEventCard\r\n                    event={event}\r\n                    isPast\r\n                    selectedDate={selectedDate}\r\n                    onTriggerNow={handleTriggerNow}\r\n                    onDelete={handleDelete}\r\n                    isTriggering={triggeringId === event.id}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n\r\n            {/* Separator: current time */}\r\n            {showNowSeparator && (\r\n              <div className=\"relative flex gap-3 pl-2 sm:pl-3\">\r\n                <div className=\"absolute left-0 top-4 h-2.5 w-2.5 shrink-0 rounded-full border-2 border-primary bg-card\" />\r\n                <div className=\"flex-1 pt-0\">\r\n                  <div className=\"rounded-lg border border-border bg-muted px-3 py-2\">\r\n                    <span className=\"text-xs font-medium text-foreground\">\r\n                      Current time: {nowTime}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Upcoming events */}\r\n            {futureEvents.map((event) => (\r\n              <div key={event.id} className=\"relative flex gap-4 pl-2 sm:pl-3\">\r\n                <div className=\"absolute left-0 top-6 h-4 w-4 shrink-0 rounded-full bg-primary sm:left-1\" aria-hidden />\r\n                <div className=\"flex-1 pt-0\">\r\n                  <TimelineEventCard\r\n                    event={event}\r\n                    isPast={false}\r\n                    selectedDate={selectedDate}\r\n                    onTriggerNow={handleTriggerNow}\r\n                    onDelete={handleDelete}\r\n                    isTriggering={triggeringId === event.id}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n\r\n            {pastEvents.length === 0 && futureEvents.length === 0 && (\r\n              <div className=\"rounded-lg border border-dashed border-border bg-card p-6 text-center\">\r\n                <CalendarPlus className=\"mx-auto h-10 w-10 text-muted-foreground\" aria-hidden />\r\n                <p className=\"mt-3 text-sm font-medium text-foreground\">No events on this day</p>\r\n                <p className=\"mt-1 text-xs text-muted-foreground\">Schedule a reminder to keep your loved one reassured.</p>\r\n                <Button size=\"md\" className=\"mt-4\" onClick={() => setReminderModalOpen(true)}>\r\n                  Schedule a reminder\r\n                </Button>\r\n              </div>\r\n            )}\r\n          </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      )}\r\n\r\n      {/* Modal: Direct voice message */}\r\n      <Modal\r\n        open={voiceModalOpen}\r\n        onClose={closeVoiceModal}\r\n        title=\"Direct voice message\"\r\n        size=\"lg\"\r\n        footer={\r\n          <>\r\n            <Button variant=\"secondary\" onClick={closeVoiceModal}>\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              onClick={handleSendVoiceMessage}\r\n              loading={voiceSending}\r\n              disabled={!voiceMessage.trim()}\r\n            >\r\n              {voiceSendMode === \"now\" ? \"Send now\" : \"Schedule message\"}\r\n            </Button>\r\n          </>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <p className=\"text-sm text-gray-600\">\r\n            {voiceSendMode === \"now\"\r\n              ? \"Your message will be played immediately on your loved one's device. The speaker will say who the message is from.\"\r\n              : \"Schedule a voice message to be played at a specific date and time. The speaker will announce the sender's name before the message.\"}\r\n          </p>\r\n\r\n          <Input\r\n            label=\"Sender name (read aloud by the device)\"\r\n            placeholder=\"e.g. Marie, Dad, Sophie\"\r\n            value={voiceSenderName}\r\n            onChange={(e) => setVoiceSenderName(e.target.value)}\r\n          />\r\n\r\n          <Textarea\r\n            label=\"Message\"\r\n            placeholder=\"e.g. Don't forget to take your pill...\"\r\n            value={voiceMessage}\r\n            onChange={(e) => setVoiceMessage(e.target.value)}\r\n            rows={4}\r\n          />\r\n\r\n          <div className=\"space-y-3 rounded-lg border border-gray-200 p-3\">\r\n            <span className=\"text-sm font-medium text-gray-700\">When to play</span>\r\n            <div className=\"flex flex-col gap-2 sm:flex-row sm:flex-wrap\">\r\n              <label className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"voiceSendMode\"\r\n                  checked={voiceSendMode === \"now\"}\r\n                  onChange={() => setVoiceSendMode(\"now\")}\r\n                  className=\"border-gray-300 text-indigo-600 focus:ring-indigo-500\"\r\n                />\r\n                <span className=\"text-sm text-gray-700\">Send now (play immediately)</span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"voiceSendMode\"\r\n                  checked={voiceSendMode === \"scheduled\"}\r\n                  onChange={() => setVoiceSendMode(\"scheduled\")}\r\n                  className=\"border-gray-300 text-indigo-600 focus:ring-indigo-500\"\r\n                />\r\n                <span className=\"text-sm text-gray-700\">Schedule for later</span>\r\n              </label>\r\n            </div>\r\n            {voiceSendMode === \"scheduled\" && (\r\n              <div className=\"mt-3 flex flex-wrap gap-3\">\r\n                <Input\r\n                  label=\"Date\"\r\n                  type=\"date\"\r\n                  value={voiceScheduleDate}\r\n                  onChange={(e) => setVoiceScheduleDate(e.target.value)}\r\n                />\r\n                <Input\r\n                  label=\"Time\"\r\n                  type=\"time\"\r\n                  value={voiceScheduleTime}\r\n                  onChange={(e) => setVoiceScheduleTime(e.target.value)}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n\r\n      {/* Modal: Schedule a reminder */}\r\n      <Modal\r\n        open={reminderModalOpen}\r\n        onClose={() => setReminderModalOpen(false)}\r\n        title=\"Schedule a reminder\"\r\n        size=\"lg\"\r\n        footer={\r\n          <>\r\n            <Button variant=\"secondary\" onClick={() => setReminderModalOpen(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              onClick={handleCreateReminder}\r\n              loading={submitting}\r\n              disabled={!reminderTitle.trim()}\r\n            >\r\n              Create reminder\r\n            </Button>\r\n          </>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <Input\r\n            label=\"Date\"\r\n            type=\"date\"\r\n            value={reminderDate}\r\n            onChange={(e) => setReminderDate(e.target.value)}\r\n          />\r\n          <Input\r\n            label=\"Title\"\r\n            placeholder=\"e.g. Morning medication\"\r\n            value={reminderTitle}\r\n            onChange={(e) => setReminderTitle(e.target.value)}\r\n          />\r\n          <Select\r\n            label=\"Type\"\r\n            value={reminderType}\r\n            options={[\r\n              { value: \"medication\", label: \"Medication\" },\r\n              { value: \"appointment\", label: \"Medical appointment\" },\r\n              { value: \"visit\", label: \"Visit\" },\r\n              { value: \"voice_message\", label: \"Voice message\" },\r\n              { value: \"whatsapp_message\", label: \"Message WhatsApp\" },\r\n            ]}\r\n            onChange={(e) => setReminderType(e.target.value as EventCategory)}\r\n          />\r\n          <Input\r\n            label=\"Time\"\r\n            type=\"time\"\r\n            value={reminderTime}\r\n            onChange={(e) => setReminderTime(e.target.value)}\r\n          />\r\n\r\n          {/* Recurrence ÔÇô customizable */}\r\n          <div className=\"space-y-4 rounded-lg border border-gray-200 bg-white p-4\">\r\n            <div className=\"flex items-center justify-between gap-2\">\r\n              <label className=\"text-sm font-medium text-gray-700\">Repeat</label>\r\n              <span className=\"text-xs text-gray-500\">Customize pattern</span>\r\n            </div>\r\n            <Select\r\n              value={repeatRule}\r\n              options={[\r\n                { value: \"none\", label: \"Never (one-time)\" },\r\n                { value: \"daily\", label: \"Daily\" },\r\n                { value: \"weekly\", label: \"Weekly\" },\r\n                { value: \"monthly\", label: \"Monthly\" },\r\n                { value: \"custom\", label: \"Custom (every X days)\" },\r\n              ]}\r\n              onChange={(e) => setRepeatRule(e.target.value as RepeatRule)}\r\n            />\r\n\r\n            {repeatRule === \"daily\" && (\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                <span className=\"text-sm text-gray-600\">Every</span>\r\n                <select\r\n                  value={repeatInterval}\r\n                  onChange={(e) => setRepeatInterval(Number(e.target.value))}\r\n                  className=\"rounded-lg border border-gray-300 px-3 py-1.5 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\r\n                >\r\n                  {[1, 2, 3, 4, 5, 6, 7].map((n) => (\r\n                    <option key={n} value={n}>{n} {n === 1 ? \"day\" : \"days\"}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            )}\r\n\r\n            {repeatRule === \"weekly\" && (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex flex-wrap items-center gap-2\">\r\n                <span className=\"text-sm text-gray-600\">Every</span>\r\n                <select\r\n                  value={repeatInterval}\r\n                  onChange={(e) => setRepeatInterval(Number(e.target.value))}\r\n                  className=\"rounded-lg border border-gray-300 px-3 py-1.5 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\r\n                >\r\n                  {[1, 2, 3, 4].map((n) => (\r\n                    <option key={n} value={n}>{n} {n === 1 ? \"week\" : \"weeks\"}</option>\r\n                  ))}\r\n                </select>\r\n                </div>\r\n                <Select\r\n                  label=\"On weekday\"\r\n                  value={repeatOnDay}\r\n                  options={WEEKDAYS}\r\n                  onChange={(e) => setRepeatOnDay(e.target.value)}\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {repeatRule === \"monthly\" && (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex flex-wrap items-center gap-2\">\r\n                <span className=\"text-sm text-gray-600\">Every</span>\r\n                <select\r\n                  value={repeatInterval}\r\n                  onChange={(e) => setRepeatInterval(Number(e.target.value))}\r\n                  className=\"rounded-lg border border-gray-300 px-3 py-1.5 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\r\n                >\r\n                  {[1, 2, 3].map((n) => (\r\n                    <option key={n} value={n}>{n} {n === 1 ? \"month\" : \"months\"}</option>\r\n                  ))}\r\n                </select>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <span className=\"text-sm font-medium text-gray-700\">On</span>\r\n                  <div className=\"flex flex-col gap-2 sm:flex-row sm:flex-wrap\">\r\n                    <label className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        name=\"monthlyKind\"\r\n                        checked={monthlyKind === \"same_date\"}\r\n                        onChange={() => setMonthlyKind(\"same_date\")}\r\n                        className=\"border-gray-300 text-indigo-600 focus:ring-indigo-500\"\r\n                      />\r\n                      <span className=\"text-sm text-gray-700\">Same date (e.g. 15th)</span>\r\n                    </label>\r\n                    <label className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        name=\"monthlyKind\"\r\n                        checked={monthlyKind === \"same_weekday\"}\r\n                        onChange={() => setMonthlyKind(\"same_weekday\")}\r\n                        className=\"border-gray-300 text-indigo-600 focus:ring-indigo-500\"\r\n                      />\r\n                      <span className=\"text-sm text-gray-700\">Same weekday (e.g. 2nd Tuesday)</span>\r\n                    </label>\r\n                  </div>\r\n                  {monthlyKind === \"same_weekday\" && (\r\n                    <div className=\"mt-2 flex flex-wrap gap-3\">\r\n                      <Select\r\n                        label=\"Occurrence in month\"\r\n                        value={monthlyOccurrence}\r\n                        options={MONTHLY_OCCURRENCES}\r\n                        onChange={(e) => setMonthlyOccurrence(e.target.value)}\r\n                      />\r\n                      <Select\r\n                        label=\"Weekday\"\r\n                        value={repeatOnDay}\r\n                        options={WEEKDAYS}\r\n                        onChange={(e) => setRepeatOnDay(e.target.value)}\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {repeatRule === \"custom\" && (\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                <span className=\"text-sm text-gray-600\">Every</span>\r\n                <input\r\n                  type=\"number\"\r\n                  min={1}\r\n                  max={365}\r\n                  value={customRepeatDays}\r\n                  onChange={(e) => setCustomRepeatDays(Math.max(1, Math.min(365, Number(e.target.value) || 1)))}\r\n                  className=\"w-16 rounded-lg border border-gray-300 px-2 py-1.5 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\r\n                />\r\n                <span className=\"text-sm text-gray-600\">day{customRepeatDays !== 1 ? \"s\" : \"\"}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <Textarea\r\n            label=\"Message (optional)\"\r\n            placeholder=\"What will be said when the reminder plays...\"\r\n            value={reminderMessage}\r\n            onChange={(e) => setReminderMessage(e.target.value)}\r\n            rows={3}\r\n          />\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\content\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\health\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WifiOff' is defined but never used.","line":4,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":59,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"WifiOff"},"fix":{"range":[95,104],"text":""},"desc":"Remove unused variable \"WifiOff\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport Link from \"next/link\"\r\nimport { Mic, Brain, Music, Check, Calendar, Wifi, WifiOff, Loader2, Pill, Stethoscope, Users, MessageCircle } from \"lucide-react\"\r\nimport { useCalendarItems } from \"@/hooks/useCalendarItems\"\r\nimport type { CalendarItem } from \"@/lib/types\"\r\n\r\n// ÔöÇÔöÇÔöÇ Helpers ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction getGreeting(): string {\r\n  const hour = new Date().getHours()\r\n  if (hour < 12) return \"Good morning\"\r\n  if (hour < 18) return \"Good afternoon\"\r\n  return \"Good evening\"\r\n}\r\n\r\nfunction getNextEvent(items: CalendarItem[]): CalendarItem | null {\r\n  const now = new Date()\r\n  const upcoming = items\r\n    .filter((item) => item.status === \"scheduled\" && new Date(item.scheduled_at) > now)\r\n    .sort((a, b) => new Date(a.scheduled_at).getTime() - new Date(b.scheduled_at).getTime())\r\n  return upcoming[0] ?? null\r\n}\r\n\r\nfunction formatRelativeTime(iso: string): string {\r\n  const now = new Date()\r\n  const target = new Date(iso)\r\n  const diffMs = target.getTime() - now.getTime()\r\n  const diffMin = Math.round(diffMs / 60000)\r\n  const diffHrs = Math.floor(diffMin / 60)\r\n  const diffDays = Math.floor(diffHrs / 24)\r\n\r\n  if (diffMin < 1) return \"now\"\r\n  if (diffMin < 60) return `in ${diffMin} min`\r\n  if (diffHrs < 24) return `in ${diffHrs}h`\r\n  if (diffDays === 1) return \"tomorrow\"\r\n  return `in ${diffDays} days`\r\n}\r\n\r\nfunction getCategoryFromItem(item: CalendarItem): { label: string; Icon: React.ElementType; colorClass: string } {\r\n  if (item.type === \"audio_push\") return { label: \"Voice message\", Icon: MessageCircle, colorClass: \"text-purple-600\" }\r\n  if (item.type === \"whatsapp_prompt\") return { label: \"WhatsApp\", Icon: MessageCircle, colorClass: \"text-green-600\" }\r\n  if (item.message_text) {\r\n    if (item.message_text.includes(\"[medication]\")) return { label: \"Medication\", Icon: Pill, colorClass: \"text-red-600\" }\r\n    if (item.message_text.includes(\"[appointment]\")) return { label: \"Appointment\", Icon: Stethoscope, colorClass: \"text-blue-600\" }\r\n    if (item.message_text.includes(\"[visit]\")) return { label: \"Visit\", Icon: Users, colorClass: \"text-green-600\" }\r\n  }\r\n  return { label: \"Reminder\", Icon: Calendar, colorClass: \"text-primary\" }\r\n}\r\n\r\nfunction formatEventTime(iso: string): string {\r\n  return new Date(iso).toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\" })\r\n}\r\n\r\nfunction formatEventDate(iso: string): string {\r\n  const d = new Date(iso)\r\n  const today = new Date()\r\n  const tomorrow = new Date(today)\r\n  tomorrow.setDate(today.getDate() + 1)\r\n\r\n  if (d.toDateString() === today.toDateString()) return \"Today\"\r\n  if (d.toDateString() === tomorrow.toDateString()) return \"Tomorrow\"\r\n  return d.toLocaleDateString(\"en-GB\", { weekday: \"long\", day: \"numeric\", month: \"long\" })\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Composant ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nconst PATIENT_NAME = \"Sophie\"\r\n\r\nexport default function DashboardHome() {\r\n  const { items, loading } = useCalendarItems()\r\n  const nextEvent = getNextEvent(items)\r\n\r\n  return (\r\n    <div className=\"space-y-5\">\r\n      {/* En-t├¬te */}\r\n      <header>\r\n        <h1 className=\"text-xl font-semibold text-foreground\">\r\n          {getGreeting()} ÔÇö {PATIENT_NAME}&apos;s care\r\n        </h1>\r\n        <p className=\"mt-1 text-sm text-muted-foreground\">\r\n          Here&apos;s how things are going right now.\r\n        </p>\r\n      </header>\r\n\r\n      {/* Statut appareil */}\r\n      <section\r\n        className=\"rounded-lg border border-border bg-card p-4\"\r\n        aria-label=\"Device status\"\r\n      >\r\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <span className=\"flex h-2.5 w-2.5 shrink-0 rounded-full bg-primary animate-pulse\" aria-hidden />\r\n            <div>\r\n              <p className=\"text-sm font-medium text-foreground\">Device connected</p>\r\n              <p className=\"mt-0.5 text-xs text-muted-foreground\">\r\n                Last activity 15 min ago\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-primary text-sm font-medium sm:shrink-0\">\r\n            <Wifi className=\"h-4 w-4\" aria-hidden />\r\n            Online\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Action rapide */}\r\n      <section aria-label=\"Action rapide\">\r\n        <Link\r\n          href=\"/dashboard/calendar\"\r\n          className=\"flex items-center justify-center gap-3 rounded-lg border border-border bg-card px-4 py-3 text-foreground transition-colors hover:bg-muted\"\r\n        >\r\n          <span className=\"flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10 text-primary\">\r\n            <Mic className=\"h-4 w-4\" strokeWidth={2} aria-hidden />\r\n          </span>\r\n          <span className=\"text-sm font-medium\">Send a voice message now</span>\r\n        </Link>\r\n      </section>\r\n\r\n      {/* Prochain ├®v├®nement */}\r\n      <section aria-label=\"Prochain ├®v├®nement\">\r\n        <div className=\"rounded-lg border border-border bg-card p-4\">\r\n          <p className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\r\n            Next event\r\n          </p>\r\n\r\n          {loading ? (\r\n            <div className=\"mt-3 flex items-center gap-2 text-sm text-muted-foreground\">\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" aria-hidden />\r\n              LoadingÔÇª\r\n            </div>\r\n          ) : nextEvent ? (() => {\r\n            const { label, Icon, colorClass } = getCategoryFromItem(nextEvent)\r\n            return (\r\n              <div className=\"mt-3 flex flex-wrap items-center gap-3\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <span className=\"flex h-9 w-9 items-center justify-center rounded-lg bg-muted\">\r\n                    <Icon className={`h-4 w-4 ${colorClass}`} aria-hidden />\r\n                  </span>\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-foreground\">\r\n                      {formatRelativeTime(nextEvent.scheduled_at)} ÔÇö {nextEvent.title}\r\n                    </p>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {formatEventDate(nextEvent.scheduled_at)} ├á {formatEventTime(nextEvent.scheduled_at)} ┬À {label}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <Link\r\n                  href=\"/dashboard/calendar\"\r\n                  className=\"ml-auto flex items-center rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90\"\r\n                >\r\n                  View agenda\r\n                </Link>\r\n              </div>\r\n            )\r\n          })() : (\r\n            <div className=\"mt-3 flex flex-wrap items-center justify-between gap-3\">\r\n              <p className=\"text-sm text-muted-foreground\">No upcoming events.</p>\r\n              <Link\r\n                href=\"/dashboard/calendar\"\r\n                className=\"flex items-center rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90\"\r\n              >\r\n                Schedule\r\n              </Link>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n\r\n      {/* R├®sum├® du jour */}\r\n      <section aria-label=\"R├®sum├® de la journ├®e\">\r\n        <h2 className=\"mb-3 text-sm font-semibold text-foreground\">\r\n          Today&apos;s summary\r\n        </h2>\r\n        <div className=\"grid gap-3 sm:grid-cols-3\">\r\n          <div className=\"rounded-lg border border-border bg-card p-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-muted\">\r\n                <Brain className=\"h-4 w-4 text-primary\" aria-hidden />\r\n              </span>\r\n              <div>\r\n                <p className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\r\n                  Stimulation\r\n                </p>\r\n                <p className=\"text-sm font-medium text-foreground\">Played Bridge</p>\r\n                <p className=\"text-xs text-muted-foreground\">15 min</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"rounded-lg border border-border bg-card p-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-muted\">\r\n                <Music className=\"h-4 w-4 text-primary\" aria-hidden />\r\n              </span>\r\n              <div>\r\n                <p className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\r\n                  Entertainment\r\n                </p>\r\n                <p className=\"text-sm font-medium text-foreground\">Listened to ├ëdith Piaf</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"rounded-lg border border-border bg-card p-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-muted\">\r\n                <Check className=\"h-4 w-4 text-primary\" aria-hidden />\r\n              </span>\r\n              <div>\r\n                <p className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\r\n                  Routines\r\n                </p>\r\n                {loading ? (\r\n                  <p className=\"text-sm text-muted-foreground\">ÔÇª</p>\r\n                ) : (\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {items.filter(i => i.status !== \"scheduled\").length}/{items.length} reminders done\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\dashboard\\timeline\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\device\\kiosk\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\device\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\device\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\GitHub_prog\\hack_europe\\frontend\\app\\device\\page.tsx:162:5\n  160 |   useEffect(() => {\n  161 |     const fmt = () => new Date().toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\" })\n> 162 |     setTime(fmt())\n      |     ^^^^^^^ Avoid calling setState() directly within an effect\n  163 |     const id = setInterval(() => setTime(fmt()), 15_000)\n  164 |     return () => clearInterval(id)\n  165 |   }, [])","line":162,"column":5,"nodeType":null,"endLine":162,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleSpeak'. Either include it or remove the dependency array.","line":285,"column":6,"nodeType":"ArrayExpression","endLine":285,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [handleSpeak, state]","fix":{"range":[11134,11141],"text":"[handleSpeak, state]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleSpeak'. Either include it or remove the dependency array.","line":303,"column":6,"nodeType":"ArrayExpression","endLine":303,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [textInput, state, handleSpeak]","fix":{"range":[11608,11626],"text":"[textInput, state, handleSpeak]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleSpeak' and 'startYesNoListen'. Either include them or remove the dependency array.","line":380,"column":6,"nodeType":"ArrayExpression","endLine":380,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [handleSpeak, startYesNoListen, state]","fix":{"range":[14264,14271],"text":"[handleSpeak, startYesNoListen, state]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\"\r\nimport { listenOnce } from \"@/lib/speech\"\r\n\r\n// ÔöÇÔöÇÔöÇ Config ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nconst BACKEND_URL =\r\n  process.env.NEXT_PUBLIC_BACKEND_URL ??\r\n  process.env.NEXT_PUBLIC_API_URL ??\r\n  \"http://localhost:8000\"\r\n\r\n// ElevenLabs called directly from the browser (avoids datacenter IP blocks on free tier)\r\nconst ELEVENLABS_API_KEY = process.env.NEXT_PUBLIC_ELEVENLABS_API_KEY ?? \"\"\r\nconst ELEVENLABS_VOICE_ID = process.env.NEXT_PUBLIC_ELEVENLABS_VOICE_ID ?? \"21m00Tcm4TlvDq8ikWAM\"\r\nconst ELEVENLABS_MODEL_ID = process.env.NEXT_PUBLIC_ELEVENLABS_MODEL_ID ?? \"eleven_turbo_v2\"\r\n\r\nconst POST_TTS_DELAY_MS = 350\r\nconst RESIDENT_NAME = \"Simone\"\r\nconst CARE_RECEIVER_ID = process.env.NEXT_PUBLIC_CARE_RECEIVER_ID ?? \"cr-0000-0001\"\r\nconst POLL_INTERVAL_MS = 3000\r\n\r\n// ÔöÇÔöÇÔöÇ Types ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\ntype State = \"idle\" | \"recording\" | \"transcribing\" | \"thinking\" | \"speaking\" | \"waiting\" | \"playing\" | \"error\"\r\n\r\n// ÔöÇÔöÇÔöÇ API helpers ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction pause(ms: number): Promise<void> {\r\n  return new Promise((r) => setTimeout(r, ms))\r\n}\r\n\r\nasync function transcribeBlob(blob: Blob): Promise<string> {\r\n  const form = new FormData()\r\n  form.append(\"audio\", blob, \"recording.webm\")\r\n  const res = await fetch(`${BACKEND_URL}/api/stt/transcribe`, { method: \"POST\", body: form })\r\n  if (!res.ok) throw new Error(`STT error ${res.status}`)\r\n  return ((await res.json()) as { text: string }).text ?? \"\"\r\n}\r\n\r\nasync function askAgent(message: string): Promise<string> {\r\n  const res = await fetch(`${BACKEND_URL}/api/chat/message`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ message }),\r\n  })\r\n  if (!res.ok) throw new Error(`Agent error ${res.status}`)\r\n  return ((await res.json()) as { response: string }).response ?? \"\"\r\n}\r\n\r\ninterface DeviceAction {\r\n  id: string\r\n  kind: string\r\n  text_to_speak: string\r\n  audio_url?: string | null\r\n  audio_title?: string | null\r\n}\r\n\r\n/**\r\n * Passe toutes les URLs audio par le proxy backend pour ├®viter les erreurs CORS.\r\n * Le proxy g├¿re aussi la conversion des liens Google Drive.\r\n */\r\nfunction toProxiedUrl(url: string): string {\r\n  return `${BACKEND_URL}/api/audio/proxy?url=${encodeURIComponent(url)}`\r\n}\r\n\r\nasync function playAudioUrl(url: string): Promise<void> {\r\n  const src = toProxiedUrl(url)\r\n  return new Promise((resolve) => {\r\n    const audio = new window.Audio(src)\r\n    audio.onended = () => resolve()\r\n    audio.onerror = (e) => {\r\n      console.warn(\"[device] Audio playback error:\", e, \"url:\", src)\r\n      resolve()\r\n    }\r\n    audio.play().catch((e) => {\r\n      console.warn(\"[device] Audio play() blocked:\", e)\r\n      resolve()\r\n    })\r\n  })\r\n}\r\n\r\nasync function fetchNextActions(): Promise<DeviceAction[]> {\r\n  try {\r\n    const res = await fetch(\r\n      `${BACKEND_URL}/api/chat/device/next-actions?care_receiver_id=${CARE_RECEIVER_ID}`,\r\n      { headers: { Authorization: \"Bearer demo-token\" } }\r\n    )\r\n    if (!res.ok) return []\r\n    return (await res.json()) as DeviceAction[]\r\n  } catch {\r\n    return []\r\n  }\r\n}\r\n\r\nasync function ackAction(actionId: string): Promise<void> {\r\n  try {\r\n    await fetch(`${BACKEND_URL}/api/chat/device/response`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\", Authorization: \"Bearer demo-token\" },\r\n      body: JSON.stringify({ action_id: actionId, response: \"yes\" }),\r\n    })\r\n  } catch { /* noop */ }\r\n}\r\n\r\nasync function speakText(text: string, onStart?: () => void, onEnd?: () => void): Promise<void> {\r\n  if (!ELEVENLABS_API_KEY) {\r\n    throw new Error(\r\n      \"Voice non configur├®e. Ajoute NEXT_PUBLIC_ELEVENLABS_API_KEY dans les variables d'environnement Vercel (Settings > Environment Variables).\"\r\n    )\r\n  }\r\n\r\n  const res = await fetch(\r\n    `https://api.elevenlabs.io/v1/text-to-speech/${ELEVENLABS_VOICE_ID}`,\r\n    {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"xi-api-key\": ELEVENLABS_API_KEY,\r\n        \"Content-Type\": \"application/json\",\r\n        \"Accept\": \"audio/mpeg\",\r\n      },\r\n      body: JSON.stringify({\r\n        text,\r\n        model_id: ELEVENLABS_MODEL_ID,\r\n        voice_settings: { stability: 0.5, similarity_boost: 0.75 },\r\n      }),\r\n    }\r\n  )\r\n  if (!res.ok) throw new Error(`TTS error ${res.status}: ${await res.text()}`)\r\n  const audioCtx = new AudioContext()\r\n  const buf = await audioCtx.decodeAudioData(await res.arrayBuffer())\r\n  const src = audioCtx.createBufferSource()\r\n  src.buffer = buf\r\n  src.connect(audioCtx.destination)\r\n  await new Promise<void>((resolve, reject) => {\r\n    src.onended = () => resolve()\r\n    try { onStart?.(); src.start(0) } catch (e) { reject(e) }\r\n  })\r\n  onEnd?.()\r\n  await audioCtx.close()\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Design tokens per state ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nconst TOKEN = {\r\n  idle: { orb: \"#00a0dc\", glow: \"rgba(0,160,220,0.45)\", ring: \"rgba(0,160,220,0.2)\", label: `Hello, ${RESIDENT_NAME}`, sub: \"Tap to speak\" },\r\n  recording: { orb: \"#16a34a\", glow: \"rgba(22,163,74,0.45)\", ring: \"rgba(22,163,74,0.2)\", label: \"ListeningÔÇª\", sub: \"Tap again to stop\" },\r\n  transcribing: { orb: \"#d97706\", glow: \"rgba(217,119,6,0.4)\", ring: \"rgba(217,119,6,0.18)\", label: \"TranscribingÔÇª\", sub: \"One momentÔÇª\" },\r\n  thinking: { orb: \"#7c3aed\", glow: \"rgba(124,58,237,0.4)\", ring: \"rgba(124,58,237,0.18)\", label: \"ThinkingÔÇª\", sub: \"One momentÔÇª\" },\r\n  speaking: { orb: \"#0077b3\", glow: \"rgba(0,119,179,0.45)\", ring: \"rgba(0,119,179,0.2)\", label: \"SpeakingÔÇª\", sub: \"\" },\r\n  waiting: { orb: \"#f59e0b\", glow: \"rgba(245,158,11,0.45)\", ring: \"rgba(245,158,11,0.2)\", label: \"Your answer?\", sub: \"Yes or No\" },\r\n  playing: { orb: \"#059669\", glow: \"rgba(5,150,105,0.45)\", ring: \"rgba(5,150,105,0.2)\", label: \"PlayingÔÇª\", sub: \"Enjoy the music!\" },\r\n  error: { orb: \"#dc2626\", glow: \"rgba(220,38,38,0.35)\", ring: \"rgba(220,38,38,0.15)\", label: \"Tap to try again\", sub: \"\" },\r\n} satisfies Record<State, { orb: string; glow: string; ring: string; label: string; sub: string }>\r\n\r\n// ÔöÇÔöÇÔöÇ Sub-components ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction Clock() {\r\n  const [time, setTime] = useState(\"\")\r\n  useEffect(() => {\r\n    const fmt = () => new Date().toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\" })\r\n    setTime(fmt())\r\n    const id = setInterval(() => setTime(fmt()), 15_000)\r\n    return () => clearInterval(id)\r\n  }, [])\r\n  return <>{time}</>\r\n}\r\n\r\nfunction Bars({ n, heights, delay, dur }: { n: number; heights: number[]; delay: number; dur: string }) {\r\n  return (\r\n    <div style={{ display: \"flex\", alignItems: \"center\", gap: 10 }}>\r\n      {Array.from({ length: n }).map((_, i) => (\r\n        <div\r\n          key={i}\r\n          className=\"bar\"\r\n          style={{\r\n            width: 13,\r\n            height: heights[i % heights.length],\r\n            borderRadius: 999,\r\n            background: \"rgba(255,255,255,0.9)\",\r\n            animationDelay: `${delay + i * 0.13}s`,\r\n            animationDuration: dur,\r\n          }}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction OrbIcon({ state }: { state: State }) {\r\n  if (state === \"recording\") return <Bars n={5} heights={[36, 60, 48, 60, 36]} delay={0} dur=\"0.6s\" />\r\n  if (state === \"speaking\") return <Bars n={5} heights={[44, 72, 56, 72, 44]} delay={0} dur=\"0.65s\" />\r\n  if (state === \"playing\") return <Bars n={5} heights={[32, 56, 72, 56, 32]} delay={0} dur=\"0.5s\" />\r\n  if (state === \"waiting\") return (\r\n    <svg width=\"72\" height=\"72\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"rgba(255,255,255,0.9)\" strokeWidth=\"1.4\" strokeLinecap=\"round\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n      <path d=\"M12 8v4l3 3\" />\r\n    </svg>\r\n  )\r\n  if (state === \"transcribing\" || state === \"thinking\") return (\r\n    <svg width=\"72\" height=\"72\" viewBox=\"0 0 24 24\" fill=\"none\" style={{ animation: \"spin 1s linear infinite\" }}>\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"rgba(255,255,255,0.2)\" strokeWidth=\"3\" />\r\n      <path d=\"M4 12a8 8 0 018-8v8H4z\" fill=\"rgba(255,255,255,0.85)\" />\r\n    </svg>\r\n  )\r\n  if (state === \"error\") return (\r\n    <svg width=\"72\" height=\"72\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"rgba(255,255,255,0.9)\" strokeWidth=\"1.5\" strokeLinecap=\"round\">\r\n      <path d=\"M18 6L6 18M6 6l12 12\" />\r\n    </svg>\r\n  )\r\n  // idle ÔÇö mic\r\n  return (\r\n    <svg width=\"80\" height=\"80\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"rgba(255,255,255,0.9)\" strokeWidth=\"1.3\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n      <path d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\r\n    </svg>\r\n  )\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Page ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nexport default function DevicePage() {\r\n  const [state, setState] = useState<State>(\"idle\")\r\n  const [transcript, setTranscript] = useState(\"\")\r\n  const [message, setMessage] = useState(\"\")\r\n  const [errorMsg, setErrorMsg] = useState(\"\")\r\n  const [ttsInput, setTtsInput] = useState(\"\")\r\n  const [showTts, setShowTts] = useState(false)\r\n  const [showHelp, setShowHelp] = useState(false)\r\n\r\n  const speakingRef = useRef(false)\r\n  const recorderRef = useRef<MediaRecorder | null>(null)\r\n  const chunksRef = useRef<Blob[]>([])\r\n  const processedIds = useRef(new Set<string>())\r\n  const pendingAudioRef = useRef<DeviceAction | null>(null)\r\n  const listeningForYesNo = useRef(false)\r\n  const [voiceListening, setVoiceListening] = useState(false)\r\n  const [textInput, setTextInput] = useState(\"\")\r\n\r\n  const tok = TOKEN[state]\r\n\r\n  // ÔöÇÔöÇ Recording ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\n  const startRecording = useCallback(async () => {\r\n    if (speakingRef.current || state !== \"idle\") return\r\n    setErrorMsg(\"\"); setTranscript(\"\")\r\n\r\n    let stream: MediaStream\r\n    try {\r\n      stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false })\r\n    } catch {\r\n      setErrorMsg(\"Microphone access denied. Please allow mic permissions.\")\r\n      setState(\"error\")\r\n      return\r\n    }\r\n\r\n    const recorder = new MediaRecorder(stream)\r\n    chunksRef.current = []\r\n    recorder.ondataavailable = (e) => { if (e.data.size > 0) chunksRef.current.push(e.data) }\r\n    recorder.onstop = async () => {\r\n      stream.getTracks().forEach((t) => t.stop())\r\n      setState(\"transcribing\")\r\n      try {\r\n        const blob = new Blob(chunksRef.current, { type: \"audio/webm\" })\r\n        const text = await transcribeBlob(blob)\r\n        setTranscript(text)\r\n\r\n        if (!text.trim()) {\r\n          setState(\"idle\")\r\n          return\r\n        }\r\n\r\n        setState(\"thinking\")\r\n        const agentReply = await askAgent(text)\r\n\r\n        // speakText handles the \"speaking\" state internally\r\n        await handleSpeak(agentReply)\r\n      } catch (err) {\r\n        setErrorMsg(err instanceof Error ? err.message : \"Something went wrong\")\r\n        setState(\"error\")\r\n      }\r\n    }\r\n    recorderRef.current = recorder\r\n    recorder.start()\r\n    setState(\"recording\")\r\n  }, [state])\r\n\r\n  const submitTextInput = useCallback(async () => {\r\n    const text = textInput.trim()\r\n    if (!text || state !== \"idle\") return\r\n\r\n    setErrorMsg(\"\")\r\n    setTranscript(text)\r\n    setTextInput(\"\")\r\n    setState(\"thinking\")\r\n\r\n    try {\r\n      const agentReply = await askAgent(text)\r\n      await handleSpeak(agentReply)\r\n    } catch (err) {\r\n      setErrorMsg(err instanceof Error ? err.message : \"Something went wrong\")\r\n      setState(\"error\")\r\n    }\r\n  }, [textInput, state])\r\n\r\n  const stopRecording = useCallback(() => {\r\n    const r = recorderRef.current\r\n    if (r && r.state !== \"inactive\") r.stop()\r\n  }, [])\r\n\r\n  const handleOrbTap = useCallback(() => {\r\n    if (state === \"idle\" || state === \"error\") startRecording()\r\n    else if (state === \"recording\") stopRecording()\r\n  }, [state, startRecording, stopRecording])\r\n\r\n  // ÔöÇÔöÇ TTS ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\n  const handleSpeak = useCallback(async (text: string) => {\r\n    if (!text.trim() || state === \"recording\" || state === \"transcribing\" || state === \"thinking\" || state === \"speaking\") return\r\n    setErrorMsg(\"\")\r\n    setState(\"speaking\")\r\n    speakingRef.current = true\r\n    setMessage(text)\r\n    try {\r\n      await speakText(text)\r\n      await pause(POST_TTS_DELAY_MS)\r\n    } catch (err) {\r\n      setErrorMsg(err instanceof Error ? err.message : \"TTS failed\")\r\n      setState(\"error\")\r\n    } finally {\r\n      speakingRef.current = false\r\n      setMessage(\"\")\r\n      setState((s) => s === \"error\" ? \"error\" : \"idle\")\r\n    }\r\n  }, [state])\r\n\r\n  // ÔöÇÔöÇ Polling next-actions (speak_reminder + propose_audio) ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\n  useEffect(() => {\r\n    let cancelled = false\r\n\r\n    async function poll() {\r\n      if (cancelled) return\r\n      if (!speakingRef.current && state === \"idle\") {\r\n        const actions = await fetchNextActions()\r\n        const next = actions.find((a) => !processedIds.current.has(a.id))\r\n        if (next && !cancelled) {\r\n          processedIds.current.add(next.id)\r\n\r\n          if (next.kind === \"speak_reminder\") {\r\n            await ackAction(next.id)\r\n            await handleSpeak(next.text_to_speak)\r\n\r\n          } else if (next.kind === \"propose_audio\") {\r\n            // 1. Parler l'invitation\r\n            pendingAudioRef.current = next\r\n            speakingRef.current = true\r\n            setState(\"speaking\")\r\n            setMessage(next.text_to_speak)\r\n            try { await speakText(next.text_to_speak) } catch { /* noop */ }\r\n            speakingRef.current = false\r\n            setMessage(\"\")\r\n            // 2. Passer en mode \"waiting\" et lancer l'├®coute vocale apr├¿s un d├®lai\r\n            // (laisser le micro se lib├®rer apr├¿s la fin du TTS)\r\n            setState(\"waiting\")\r\n            setTimeout(() => startYesNoListen(), 700)\r\n          }\r\n        }\r\n      }\r\n      if (!cancelled) {\r\n        setTimeout(poll, POLL_INTERVAL_MS)\r\n      }\r\n    }\r\n\r\n    const timer = setTimeout(poll, POLL_INTERVAL_MS)\r\n    return () => {\r\n      cancelled = true\r\n      clearTimeout(timer)\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [state])\r\n\r\n  // ÔöÇÔöÇ ├ëcoute vocale automatique pour OUI / NON ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\n  function startYesNoListen(attempt = 1) {\r\n    if (listeningForYesNo.current && attempt === 1) return\r\n    if (attempt === 1) listeningForYesNo.current = true\r\n    setVoiceListening(true)\r\n\r\n    listenOnce(8000)\r\n      .then((result) => {\r\n        listeningForYesNo.current = false\r\n        setVoiceListening(false)\r\n        if (result.intent === \"yes\") {\r\n          void handleMusicYes()\r\n        } else if (result.intent === \"no\") {\r\n          void handleMusicNo()\r\n        } else if (attempt <= 2) {\r\n          // R├®ponse inconnue (pas yes/ni no) ÔåÆ relancer\r\n          setTimeout(() => startYesNoListen(attempt + 1), 400)\r\n        } else {\r\n          // Apr├¿s 3 essais, garder les boutons visibles sans r├®essayer\r\n          listeningForYesNo.current = false\r\n          setVoiceListening(false)\r\n        }\r\n      })\r\n      .catch((err: Error) => {\r\n        if (!listeningForYesNo.current) return  // annul├® par bouton\r\n        // \"no-speech\" = silence ÔåÆ relancer silencieusement (max 5 fois)\r\n        if (err.message === \"no-speech\" && attempt <= 5) {\r\n          setTimeout(() => startYesNoListen(attempt + 1), 300)\r\n        } else {\r\n          listeningForYesNo.current = false\r\n          setVoiceListening(false)\r\n          // Micro non dispo ou timeout ÔåÆ les boutons restent\r\n        }\r\n      })\r\n  }\r\n\r\n  // ÔöÇÔöÇ R├®ponses OUI / NON pour propose_audio ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\n  const handleMusicYes = useCallback(async () => {\r\n    if (!pendingAudioRef.current) return\r\n    listeningForYesNo.current = false   // annuler l'├®coute en cours\r\n    setVoiceListening(false)\r\n    const action = pendingAudioRef.current\r\n    pendingAudioRef.current = null\r\n    await ackAction(action.id)\r\n\r\n    // Dire \"Super !\" puis jouer la musique\r\n    setState(\"speaking\")\r\n    speakingRef.current = true\r\n    const title = action.audio_title ?? \"your music\"\r\n    setMessage(`Playing ${title}ÔÇª`)\r\n    try { await speakText(`Sure! Enjoy ${title}.`) } catch { /* noop */ }\r\n    speakingRef.current = false\r\n\r\n    if (action.audio_url) {\r\n      setState(\"playing\")\r\n      setMessage(title)\r\n      await playAudioUrl(action.audio_url)\r\n    }\r\n    setMessage(\"\")\r\n    setState(\"idle\")\r\n  }, [])\r\n\r\n  const handleMusicNo = useCallback(async () => {\r\n    if (!pendingAudioRef.current) return\r\n    listeningForYesNo.current = false   // annuler l'├®coute en cours\r\n    setVoiceListening(false)\r\n    const action = pendingAudioRef.current\r\n    pendingAudioRef.current = null\r\n    await ackAction(action.id)\r\n    setState(\"speaking\")\r\n    speakingRef.current = true\r\n    setMessage(\"No problem!\")\r\n    try { await speakText(\"No problem! Have a great day.\") } catch { /* noop */ }\r\n    speakingRef.current = false\r\n    setMessage(\"\")\r\n    setState(\"idle\")\r\n  }, [])\r\n\r\n  // ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\n  const orbTappable = state === \"idle\" || state === \"recording\" || state === \"error\"\r\n  const isBusy = state === \"transcribing\" || state === \"thinking\" || state === \"speaking\" || state === \"waiting\" || state === \"playing\"\r\n\r\n  return (\r\n    <>\r\n      {/* ÔöÇÔöÇ Keyframes ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ */}\r\n      <style>{`\r\n        @keyframes bar   { from{transform:scaleY(0.2)} to{transform:scaleY(1)} }\r\n        @keyframes spin  { to{transform:rotate(360deg)} }\r\n        @keyframes rings {\r\n          0%   { transform:scale(1);   opacity:.55 }\r\n          100% { transform:scale(1.9); opacity:0   }\r\n        }\r\n        .bar { animation: bar ease-in-out infinite alternate; }\r\n      `}</style>\r\n\r\n      {/* ÔöÇÔöÇ Root ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ */}\r\n      <div style={{\r\n        height: \"100%\",\r\n        width: \"100%\",\r\n        background: \"#f5f6f8\",\r\n        display: \"grid\",\r\n        gridTemplateRows: \"64px 1fr 96px\",\r\n        overflow: \"hidden\",\r\n      }}>\r\n\r\n        {/* ÔöÇÔöÇ Top bar ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ */}\r\n        <div style={{\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"space-between\",\r\n          padding: \"0 32px\",\r\n        }}>\r\n          <span style={{ color: \"#6b7280\", fontSize: 18, fontWeight: 300, fontVariantNumeric: \"tabular-nums\" }}>\r\n            <Clock />\r\n          </span>\r\n\r\n          {/* Status pill */}\r\n          <div style={{\r\n            display: \"flex\", alignItems: \"center\", gap: 8,\r\n            padding: \"8px 18px\", borderRadius: 999,\r\n            background: \"#ffffff\",\r\n            border: \"1px solid #e5e7eb\",\r\n          }}>\r\n            <div style={{\r\n              width: 8, height: 8, borderRadius: \"50%\",\r\n              background: tok.orb,\r\n              boxShadow: `0 0 6px ${tok.glow}`,\r\n              animation: state !== \"idle\" && state !== \"error\" ? \"bar 1s ease-in-out infinite alternate\" : undefined,\r\n            }} />\r\n            <span style={{ color: \"#6b7280\", fontSize: 14, fontWeight: 500, textTransform: \"capitalize\", letterSpacing: \"0.04em\" }}>\r\n              {state}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ÔöÇÔöÇ Center ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ */}\r\n        <div style={{\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          gap: 36,\r\n          padding: \"0 32px\",\r\n        }}>\r\n\r\n          {/* Orb */}\r\n          <button\r\n            onClick={handleOrbTap}\r\n            disabled={!orbTappable}\r\n            aria-label={state === \"recording\" ? \"Stop recording\" : \"Start recording\"}\r\n            style={{\r\n              position: \"relative\",\r\n              width: 240,\r\n              height: 240,\r\n              minWidth: 240,\r\n              borderRadius: \"50%\",\r\n              background: tok.orb,\r\n              boxShadow: `0 0 80px 16px ${tok.glow}`,\r\n              border: `8px solid ${tok.ring}`,\r\n              display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\r\n              cursor: orbTappable ? \"pointer\" : \"default\",\r\n              transition: \"background 0.4s, box-shadow 0.4s, border-color 0.4s\",\r\n              outline: \"none\",\r\n              flexShrink: 0,\r\n            }}\r\n          >\r\n            {/* Expanding ring animation when recording */}\r\n            {state === \"recording\" && (\r\n              <>\r\n                <div style={{\r\n                  position: \"absolute\", inset: -2, borderRadius: \"50%\",\r\n                  border: `3px solid ${tok.glow}`,\r\n                  animation: \"rings 1.4s ease-out infinite\",\r\n                }} />\r\n                <div style={{\r\n                  position: \"absolute\", inset: -2, borderRadius: \"50%\",\r\n                  border: `3px solid ${tok.glow}`,\r\n                  animation: \"rings 1.4s ease-out 0.7s infinite\",\r\n                }} />\r\n              </>\r\n            )}\r\n            <OrbIcon state={state} />\r\n          </button>\r\n\r\n          {/* Text block */}\r\n          <div style={{ textAlign: \"center\", width: \"100%\", maxWidth: 480 }}>\r\n            <p style={{\r\n              color: \"#2e2e2e\",\r\n              fontSize: 48,\r\n              fontWeight: 700,\r\n              letterSpacing: \"-0.02em\",\r\n              lineHeight: 1.15,\r\n              margin: 0,\r\n              marginBottom: 12,\r\n            }}>\r\n              {state === \"speaking\" && message ? message : tok.label}\r\n            </p>\r\n            {tok.sub && state !== \"speaking\" && (\r\n              <p style={{\r\n                color: \"#6b7280\",\r\n                fontSize: 22,\r\n                fontWeight: 400,\r\n                margin: 0,\r\n              }}>\r\n                {tok.sub}\r\n              </p>\r\n            )}\r\n            {state === \"error\" && errorMsg && (\r\n              <p style={{\r\n                color: \"#dc2626\",\r\n                fontSize: 16,\r\n                marginTop: 12,\r\n                lineHeight: 1.5,\r\n              }}>\r\n                {errorMsg}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {/* Text Input Block for Testing */}\r\n          <div style={{\r\n            width: \"100%\", maxWidth: 480,\r\n            display: \"flex\", gap: 10,\r\n          }}>\r\n            <input\r\n              type=\"text\"\r\n              value={textInput}\r\n              onChange={(e) => setTextInput(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  e.preventDefault()\r\n                  void submitTextInput()\r\n                }\r\n              }}\r\n              placeholder=\"Type your message here...\"\r\n              disabled={isBusy}\r\n              style={{\r\n                flex: 1,\r\n                background: \"#ffffff\",\r\n                border: \"1px solid #e5e7eb\",\r\n                borderRadius: 16,\r\n                padding: \"16px 20px\",\r\n                color: \"#2e2e2e\",\r\n                fontSize: 16,\r\n                outline: \"none\",\r\n                fontFamily: \"inherit\",\r\n              }}\r\n            />\r\n            <button\r\n              onClick={() => void submitTextInput()}\r\n              disabled={isBusy || !textInput.trim()}\r\n              style={{\r\n                width: 60, height: \"100%\",\r\n                borderRadius: 14,\r\n                background: \"#7c3aed\",\r\n                color: \"#fff\",\r\n                border: \"none\",\r\n                cursor: \"pointer\",\r\n                fontSize: 20,\r\n                flexShrink: 0,\r\n                opacity: (isBusy || !textInput.trim()) ? 0.5 : 1,\r\n                display: \"flex\", alignItems: \"center\", justifyContent: \"center\"\r\n              }}\r\n            >\r\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\r\n                <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Boutons OUI / NON pour la musique */}\r\n          {state === \"waiting\" && (\r\n            <div style={{ display: \"flex\", flexDirection: \"column\", gap: 12, width: \"100%\", maxWidth: 480, marginTop: 8 }}>\r\n              {/* Indicateur d'├®coute vocale */}\r\n              {voiceListening && (\r\n                <div style={{\r\n                  display: \"flex\", alignItems: \"center\", justifyContent: \"center\", gap: 10,\r\n                  padding: \"10px 20px\", borderRadius: 14,\r\n                  background: \"rgba(0,160,220,0.08)\",\r\n                  border: \"1px solid rgba(0,160,220,0.25)\",\r\n                }}>\r\n                  <span style={{\r\n                    width: 10, height: 10, borderRadius: \"50%\",\r\n                    background: \"#00a0dc\",\r\n                    display: \"inline-block\",\r\n                    animation: \"bar 0.8s ease-in-out infinite alternate\",\r\n                  }} />\r\n                  <span style={{ color: \"#00a0dc\", fontSize: 15, fontWeight: 600 }}>\r\n                    ListeningÔÇª say &quot;Yes&quot; or &quot;No&quot;\r\n                  </span>\r\n                </div>\r\n              )}\r\n              <div style={{ display: \"flex\", gap: 16 }}>\r\n                <button\r\n                  onClick={() => void handleMusicYes()}\r\n                  style={{\r\n                    flex: 1, padding: \"22px 0\",\r\n                    borderRadius: 20,\r\n                    background: \"#16a34a\",\r\n                    border: \"none\",\r\n                    color: \"#fff\",\r\n                    fontSize: 24,\r\n                    fontWeight: 700,\r\n                    cursor: \"pointer\",\r\n                    boxShadow: \"0 4px 16px rgba(22,163,74,0.35)\",\r\n                  }}\r\n                >\r\n                  Ô£ô Yes\r\n                </button>\r\n                <button\r\n                  onClick={() => void handleMusicNo()}\r\n                  style={{\r\n                    flex: 1, padding: \"22px 0\",\r\n                    borderRadius: 20,\r\n                    background: \"#6b7280\",\r\n                    border: \"none\",\r\n                    color: \"#fff\",\r\n                    fontSize: 24,\r\n                    fontWeight: 700,\r\n                    cursor: \"pointer\",\r\n                    boxShadow: \"0 4px 16px rgba(107,114,128,0.25)\",\r\n                  }}\r\n                >\r\n                  Ô£ù No\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Transcript card ÔÇö visible while AI processes and speaks so user sees what was heard */}\r\n          {transcript && (state === \"idle\" || state === \"thinking\" || state === \"speaking\") && (\r\n            <div style={{\r\n              width: \"100%\", maxWidth: 480,\r\n              background: \"#ffffff\",\r\n              border: \"1px solid #e5e7eb\",\r\n              borderRadius: 20,\r\n              padding: \"18px 24px\",\r\n              textAlign: \"left\",\r\n            }}>\r\n              <p style={{ color: \"#6b7280\", fontSize: 11, fontWeight: 600, textTransform: \"uppercase\", letterSpacing: \"0.1em\", margin: \"0 0 8px\" }}>\r\n                You said\r\n              </p>\r\n              <p style={{ color: \"#2e2e2e\", fontSize: 18, lineHeight: 1.5, margin: 0 }}>\r\n                {transcript}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* TTS panel */}\r\n          {showTts && (\r\n            <div style={{\r\n              width: \"100%\", maxWidth: 480,\r\n              display: \"flex\", gap: 10,\r\n            }}>\r\n              <textarea\r\n                value={ttsInput}\r\n                onChange={(e) => setTtsInput(e.target.value)}\r\n                rows={2}\r\n                placeholder=\"Type something to speakÔÇª\"\r\n                style={{\r\n                  flex: 1,\r\n                  background: \"#ffffff\",\r\n                  border: \"1px solid #e5e7eb\",\r\n                  borderRadius: 16,\r\n                  padding: \"12px 16px\",\r\n                  color: \"#2e2e2e\",\r\n                  fontSize: 15,\r\n                  resize: \"none\",\r\n                  outline: \"none\",\r\n                  fontFamily: \"inherit\",\r\n                }}\r\n              />\r\n              <button\r\n                onClick={() => handleSpeak(ttsInput)}\r\n                disabled={isBusy || !ttsInput.trim()}\r\n                style={{\r\n                  width: 52, height: \"100%\",\r\n                  minHeight: 56,\r\n                  borderRadius: 14,\r\n                  background: \"#00a0dc\",\r\n                  color: \"#fff\",\r\n                  border: \"none\",\r\n                  cursor: \"pointer\",\r\n                  fontSize: 18,\r\n                  flexShrink: 0,\r\n                  opacity: (isBusy || !ttsInput.trim()) ? 0.4 : 1,\r\n                }}\r\n              >\r\n                ÔûÂ\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* ÔöÇÔöÇ Bottom bar ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ */}\r\n        <div style={{\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"space-between\",\r\n          padding: \"0 24px\",\r\n          borderTop: \"1px solid #e5e7eb\",\r\n        }}>\r\n\r\n          {/* TTS toggle ÔÇö subtle, developer-facing */}\r\n          <button\r\n            onClick={() => setShowTts((v) => !v)}\r\n            style={{\r\n              display: \"flex\", alignItems: \"center\", gap: 8,\r\n              padding: \"10px 18px\",\r\n              borderRadius: 12,\r\n              background: showTts ? \"#e5e7eb\" : \"#f5f6f8\",\r\n              border: \"1px solid #e5e7eb\",\r\n              color: \"#6b7280\",\r\n              fontSize: 13, fontWeight: 500,\r\n              cursor: \"pointer\",\r\n            }}\r\n          >\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n              <path d=\"M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07\" />\r\n            </svg>\r\n            TTS test\r\n          </button>\r\n\r\n          {/* Help ÔÇö prominent, always visible */}\r\n          <button\r\n            onClick={() => setShowHelp(true)}\r\n            style={{\r\n              display: \"flex\", alignItems: \"center\", gap: 10,\r\n              padding: \"16px 28px\",\r\n              borderRadius: 18,\r\n              background: \"rgba(220,38,38,0.08)\",\r\n              border: \"1.5px solid rgba(220,38,38,0.25)\",\r\n              color: \"#dc2626\",\r\n              fontSize: 18, fontWeight: 600,\r\n              cursor: \"pointer\",\r\n              letterSpacing: \"0.01em\",\r\n            }}\r\n          >\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n              <path d=\"M12 8v4m0 4h.01\" />\r\n            </svg>\r\n            I need help\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ÔöÇÔöÇ Help modal ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ */}\r\n      {showHelp && (\r\n        <div style={{\r\n          position: \"fixed\", inset: 0,\r\n          background: \"rgba(0,0,0,0.45)\",\r\n          backdropFilter: \"blur(8px)\",\r\n          display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\r\n          padding: 32, zIndex: 50,\r\n        }}>\r\n          <div style={{\r\n            background: \"#ffffff\",\r\n            border: \"1px solid #e5e7eb\",\r\n            borderRadius: 28,\r\n            padding: 40,\r\n            maxWidth: 400,\r\n            width: \"100%\",\r\n            textAlign: \"center\",\r\n            boxShadow: \"0 8px 24px rgba(0,0,0,0.12)\",\r\n          }}>\r\n            <p style={{ color: \"#2e2e2e\", fontSize: 26, fontWeight: 600, lineHeight: 1.35, margin: \"0 0 32px\" }}>\r\n              Do you need assistance?\r\n            </p>\r\n            <div style={{ display: \"flex\", flexDirection: \"column\", gap: 16 }}>\r\n              <button\r\n                onClick={() => setShowHelp(false)}\r\n                style={{\r\n                  padding: \"20px 24px\", borderRadius: 18,\r\n                  background: \"#00a0dc\", border: \"none\",\r\n                  color: \"#fff\", fontSize: 20, fontWeight: 700,\r\n                  cursor: \"pointer\",\r\n                }}\r\n              >\r\n                I&apos;m fine, close\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  setShowHelp(false)\r\n                  handleSpeak(\"Your caregiver has been notified and will be with you soon.\")\r\n                }}\r\n                style={{\r\n                  padding: \"20px 24px\", borderRadius: 18,\r\n                  background: \"#dc2626\", border: \"none\",\r\n                  color: \"#fff\", fontSize: 20, fontWeight: 700,\r\n                  cursor: \"pointer\",\r\n                }}\r\n              >\r\n                Notify my caregiver ÔåÆ\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\EnvConfigBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\calendar\\CalendarGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EventCard' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"EventCard"},"fix":{"range":[258,299],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useRef, useEffect } from \"react\"\r\nimport { motion } from \"framer-motion\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport type { CalendarEvent, ViewMode } from \"@/lib/calendar-types\"\r\nimport { CATEGORY_CONFIG } from \"@/lib/calendar-types\"\r\nimport { EventCard } from \"./EventCard\"\r\n\r\ninterface CalendarGridProps {\r\n  viewMode: ViewMode\r\n  selectedDate: string\r\n  eventsByDate: Record<string, CalendarEvent[]>\r\n  onSelectDate: (date: string) => void\r\n  onSelectEvent?: (event: CalendarEvent) => void\r\n}\r\n\r\nconst WEEKDAYS_FR = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"]\r\n\r\n// ÔöÇÔöÇÔöÇ Helpers ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction getTodayDate(): string {\r\n  return new Date().toISOString().slice(0, 10)\r\n}\r\n\r\nfunction isToday(dateStr: string): boolean {\r\n  return dateStr === getTodayDate()\r\n}\r\n\r\nfunction getMondayOfWeek(dateStr: string): string {\r\n  const d = new Date(dateStr + \"T12:00:00\")\r\n  const day = d.getDay()\r\n  const diff = (day + 6) % 7\r\n  d.setDate(d.getDate() - diff)\r\n  return d.toISOString().slice(0, 10)\r\n}\r\n\r\nfunction getWeekDays(dateStr: string): string[] {\r\n  const monday = getMondayOfWeek(dateStr)\r\n  const days: string[] = []\r\n  for (let i = 0; i < 7; i++) {\r\n    const d = new Date(monday + \"T12:00:00\")\r\n    d.setDate(d.getDate() + i)\r\n    days.push(d.toISOString().slice(0, 10))\r\n  }\r\n  return days\r\n}\r\n\r\nfunction getDaysInMonth(dateStr: string): Array<{ date: string; isCurrentMonth: boolean }> {\r\n  const d = new Date(dateStr + \"T12:00:00\")\r\n  const year = d.getFullYear()\r\n  const month = d.getMonth()\r\n  const first = new Date(year, month, 1)\r\n  const last = new Date(year, month + 1, 0)\r\n  const startPad = (first.getDay() + 6) % 7\r\n  const endPad = (7 - ((startPad + last.getDate()) % 7)) % 7\r\n  const days: Array<{ date: string; isCurrentMonth: boolean }> = []\r\n\r\n  for (let i = 0; i < startPad; i++) {\r\n    const prev = new Date(year, month, -startPad + i + 1)\r\n    days.push({\r\n      date: prev.toISOString().slice(0, 10),\r\n      isCurrentMonth: false,\r\n    })\r\n  }\r\n  for (let i = 1; i <= last.getDate(); i++) {\r\n    const day = new Date(year, month, i)\r\n    days.push({ date: day.toISOString().slice(0, 10), isCurrentMonth: true })\r\n  }\r\n  for (let i = 0; i < endPad; i++) {\r\n    const next = new Date(year, month + 1, i + 1)\r\n    days.push({ date: next.toISOString().slice(0, 10), isCurrentMonth: false })\r\n  }\r\n  return days\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Month View ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction MonthView({\r\n  selectedDate,\r\n  eventsByDate,\r\n  onSelectDate,\r\n}: {\r\n  selectedDate: string\r\n  eventsByDate: Record<string, CalendarEvent[]>\r\n  onSelectDate: (date: string) => void\r\n}) {\r\n  const days = getDaysInMonth(selectedDate)\r\n  return (\r\n    <>\r\n      <div className=\"grid grid-cols-7 gap-1 text-center text-xs font-medium text-muted-foreground\">\r\n        {WEEKDAYS_FR.map((d) => (\r\n          <div key={d} className=\"py-2\">{d}</div>\r\n        ))}\r\n      </div>\r\n      <div className=\"grid grid-cols-7 gap-1.5\">\r\n        {days.map(({ date, isCurrentMonth }, idx) => {\r\n          const events = eventsByDate[date] ?? []\r\n          const selected = date === selectedDate\r\n          const today = isToday(date)\r\n          return (\r\n            <motion.div\r\n              key={`${idx}-${date}`}\r\n              role=\"gridcell\"\r\n              aria-selected={selected}\r\n              whileHover={{ scale: 1.02 }}\r\n              className={cn(\r\n                \"flex min-h-[80px] flex-col rounded-lg border p-2 transition-colors cursor-pointer sm:min-h-[100px]\",\r\n                selected\r\n                  ? \"border-primary bg-primary/5 ring-[2px] ring-primary/30\"\r\n                  : today\r\n                    ? \"border-primary/50 bg-primary/5\"\r\n                    : \"border-border bg-card hover:border-primary/30 hover:bg-muted/50\",\r\n                !isCurrentMonth && \"opacity-40\",\r\n              )}\r\n              tabIndex={0}\r\n              onClick={() => onSelectDate(date)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\" || e.key === \" \") {\r\n                  e.preventDefault()\r\n                  onSelectDate(date)\r\n                }\r\n              }}\r\n            >\r\n              <span\r\n                className={cn(\r\n                  \"flex h-6 w-6 items-center justify-center rounded-full text-xs font-semibold\",\r\n                  today\r\n                    ? \"bg-primary text-primary-foreground\"\r\n                    : \"text-foreground\",\r\n                )}\r\n              >\r\n                {new Date(date + \"T12:00:00\").getDate()}\r\n              </span>\r\n              <div className=\"mt-1 flex flex-col gap-0.5 overflow-hidden\">\r\n                {events.slice(0, 2).map((ev) => (\r\n                  <span\r\n                    key={ev.id}\r\n                    className={cn(\r\n                      \"truncate rounded px-1 py-0.5 text-[10px] font-medium\",\r\n                      CATEGORY_CONFIG[ev.category].pill,\r\n                    )}\r\n                    title={ev.title}\r\n                  >\r\n                    {ev.title}\r\n                  </span>\r\n                ))}\r\n                {events.length > 2 && (\r\n                  <span className=\"text-[10px] font-medium text-muted-foreground\">\r\n                    +{events.length - 2} more\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </motion.div>\r\n          )\r\n        })}\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Week View ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nfunction WeekView({\r\n  selectedDate,\r\n  eventsByDate,\r\n  onSelectDate,\r\n}: {\r\n  selectedDate: string\r\n  eventsByDate: Record<string, CalendarEvent[]>\r\n  onSelectDate: (date: string) => void\r\n}) {\r\n  const weekDays = getWeekDays(selectedDate)\r\n  return (\r\n    <div className=\"flex flex-col gap-2\">\r\n      <div className=\"grid grid-cols-7 gap-1.5\">\r\n        {WEEKDAYS_FR.map((dayName) => (\r\n          <div key={dayName} className=\"text-center text-xs font-medium text-muted-foreground py-1\">\r\n            {dayName}\r\n          </div>\r\n        ))}\r\n        {weekDays.map((date) => {\r\n          const events = eventsByDate[date] ?? []\r\n          const selected = date === selectedDate\r\n          const today = isToday(date)\r\n          const dayNum = new Date(date + \"T12:00:00\").getDate()\r\n          return (\r\n            <motion.div\r\n              key={date}\r\n              role=\"gridcell\"\r\n              aria-selected={selected}\r\n              whileHover={{ scale: 1.01 }}\r\n              className={cn(\r\n                \"flex min-h-[130px] flex-col rounded-lg border p-2.5 transition-colors cursor-pointer\",\r\n                selected\r\n                  ? \"border-primary bg-primary/5 ring-[2px] ring-primary/30\"\r\n                  : today\r\n                    ? \"border-primary/50 bg-primary/5\"\r\n                    : \"border-border bg-card hover:border-primary/30 hover:bg-muted/50\",\r\n              )}\r\n              tabIndex={0}\r\n              onClick={() => onSelectDate(date)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\" || e.key === \" \") {\r\n                  e.preventDefault()\r\n                  onSelectDate(date)\r\n                }\r\n              }}\r\n            >\r\n              <span\r\n                className={cn(\r\n                  \"flex h-7 w-7 items-center justify-center rounded-full text-sm font-semibold\",\r\n                  today ? \"bg-primary text-primary-foreground\" : \"text-foreground\",\r\n                )}\r\n              >\r\n                {dayNum}\r\n              </span>\r\n              <div className=\"mt-1.5 flex flex-col gap-1 overflow-y-auto\">\r\n                {events.slice(0, 3).map((ev) => (\r\n                  <span\r\n                    key={ev.id}\r\n                    className={cn(\r\n                      \"truncate rounded px-1.5 py-0.5 text-[10px] font-medium\",\r\n                      CATEGORY_CONFIG[ev.category].pill,\r\n                    )}\r\n                    title={ev.title}\r\n                  >\r\n                    {ev.time} {ev.title}\r\n                  </span>\r\n                ))}\r\n                {events.length > 3 && (\r\n                  <span className=\"text-[10px] text-muted-foreground\">+{events.length - 3}</span>\r\n                )}\r\n              </div>\r\n            </motion.div>\r\n          )\r\n        })}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Day View (timeline horaire) ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nconst HOUR_START = 7\r\nconst HOUR_END = 22\r\n\r\nfunction DayView({\r\n  selectedDate,\r\n  eventsByDate,\r\n}: {\r\n  selectedDate: string\r\n  eventsByDate: Record<string, CalendarEvent[]>\r\n}) {\r\n  const events = [...(eventsByDate[selectedDate] ?? [])].sort((a, b) =>\r\n    a.time.localeCompare(b.time),\r\n  )\r\n  const nowRef = useRef<HTMLDivElement>(null)\r\n  const today = isToday(selectedDate)\r\n  const now = new Date()\r\n  const nowHour = now.getHours()\r\n  const nowMin = now.getMinutes()\r\n\r\n  useEffect(() => {\r\n    if (today && nowRef.current) {\r\n      nowRef.current.scrollIntoView({ behavior: \"smooth\", block: \"center\" })\r\n    }\r\n  }, [today, selectedDate])\r\n\r\n  const dayLabel = new Date(selectedDate + \"T12:00:00\").toLocaleDateString(\"en-GB\", {\r\n    weekday: \"long\",\r\n    day: \"numeric\",\r\n    month: \"long\",\r\n  })\r\n\r\n  const hours = Array.from({ length: HOUR_END - HOUR_START }, (_, i) => HOUR_START + i)\r\n\r\n  function getEventsForHour(hour: number): CalendarEvent[] {\r\n    return events.filter((ev) => {\r\n      const h = parseInt(ev.time.split(\":\")[0], 10)\r\n      return h === hour\r\n    })\r\n  }\r\n\r\n  const hasAnyEvent = events.length > 0\r\n  const nowIsInRange = today && nowHour >= HOUR_START && nowHour < HOUR_END\r\n\r\n  return (\r\n    <div className=\"rounded-xl border border-border bg-card overflow-hidden\">\r\n      <div className=\"border-b border-border bg-muted/30 px-4 py-3\">\r\n        <h3 className=\"text-sm font-semibold capitalize text-foreground\">{dayLabel}</h3>\r\n        {!hasAnyEvent && (\r\n          <p className=\"mt-0.5 text-xs text-muted-foreground\">No events scheduled</p>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"relative divide-y divide-border/50\">\r\n        {hours.map((hour) => {\r\n          const hourEvents = getEventsForHour(hour)\r\n          const isNowHour = today && nowHour === hour\r\n          const showNowLine = nowIsInRange && isNowHour\r\n          const nowPct = (nowMin / 60) * 100\r\n\r\n          return (\r\n            <div key={hour} className=\"relative flex min-h-[52px] gap-3 px-4 py-2\">\r\n              {/* Heure */}\r\n              <div className=\"w-12 shrink-0 pt-0.5\">\r\n                <span className={cn(\"text-xs font-medium tabular-nums\", isNowHour ? \"text-primary font-semibold\" : \"text-muted-foreground\")}>\r\n                  {String(hour).padStart(2, \"0\")}:00\r\n                </span>\r\n              </div>\r\n\r\n              {/* Ligne \"maintenant\" */}\r\n              {showNowLine && (\r\n                <div\r\n                  ref={nowRef}\r\n                  className=\"pointer-events-none absolute left-0 right-0 z-10 flex items-center gap-1\"\r\n                  style={{ top: `${nowPct}%` }}\r\n                >\r\n                  <div className=\"h-2 w-2 shrink-0 rounded-full bg-red-500 ml-14\" />\r\n                  <div className=\"h-px flex-1 bg-red-400\" />\r\n                  <span className=\"pr-3 text-[10px] font-semibold text-red-500\">\r\n                    {String(nowHour).padStart(2, \"0\")}:{String(nowMin).padStart(2, \"0\")}\r\n                  </span>\r\n                </div>\r\n              )}\r\n\r\n              {/* ├ëv├®nements */}\r\n              <div className=\"flex flex-1 flex-col gap-1.5\">\r\n                {hourEvents.map((ev) => {\r\n                  const config = CATEGORY_CONFIG[ev.category]\r\n                  return (\r\n                    <div\r\n                      key={ev.id}\r\n                      className={cn(\r\n                        \"flex items-center gap-2 rounded-lg px-3 py-2\",\r\n                        ev.isDone ? \"bg-muted/60 opacity-70\" : config.bg,\r\n                      )}\r\n                    >\r\n                      <span className={cn(\"shrink-0 text-xs font-semibold tabular-nums\", ev.isDone ? \"text-muted-foreground\" : config.text)}>\r\n                        {ev.time}\r\n                      </span>\r\n                      <span className={cn(\"flex-1 truncate text-sm font-medium\", ev.isDone ? \"text-muted-foreground line-through\" : config.text)}>\r\n                        {ev.title}\r\n                      </span>\r\n                      {ev.isDone && (\r\n                        <span className=\"shrink-0 rounded-full bg-primary/10 px-1.5 py-0.5 text-[10px] font-medium text-primary\">\r\n                          Done\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  )\r\n                })}\r\n              </div>\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ÔöÇÔöÇÔöÇ Export ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇ\r\n\r\nexport function CalendarGrid({\r\n  viewMode,\r\n  selectedDate,\r\n  eventsByDate,\r\n  onSelectDate,\r\n}: CalendarGridProps) {\r\n  const ariaLabel =\r\n    viewMode === \"month\"\r\n      ? `Calendar ÔÇö ${new Date(selectedDate + \"T12:00:00\").toLocaleDateString(\"en-GB\", { month: \"long\", year: \"numeric\" })}`\r\n      : viewMode === \"week\"\r\n        ? \"Week view\"\r\n        : `Day view ÔÇö ${new Date(selectedDate + \"T12:00:00\").toLocaleDateString(\"en-GB\", { weekday: \"long\" })}`\r\n\r\n  return (\r\n    <motion.div\r\n      key={viewMode}\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      transition={{ duration: 0.2 }}\r\n      className=\"flex flex-col gap-2\"\r\n      role=\"grid\"\r\n      aria-label={ariaLabel}\r\n    >\r\n      {viewMode === \"month\" && (\r\n        <MonthView selectedDate={selectedDate} eventsByDate={eventsByDate} onSelectDate={onSelectDate} />\r\n      )}\r\n      {viewMode === \"week\" && (\r\n        <WeekView selectedDate={selectedDate} eventsByDate={eventsByDate} onSelectDate={onSelectDate} />\r\n      )}\r\n      {viewMode === \"day\" && (\r\n        <DayView selectedDate={selectedDate} eventsByDate={eventsByDate} />\r\n      )}\r\n    </motion.div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\calendar\\DayHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\calendar\\EventCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\calendar\\EventSidebar.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":154,"column":47,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5461,5489],"text":"Click &quot;Add\" to schedule one."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5461,5489],"text":"Click &ldquo;Add\" to schedule one."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5461,5489],"text":"Click &#34;Add\" to schedule one."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5461,5489],"text":"Click &rdquo;Add\" to schedule one."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":154,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5461,5489],"text":"Click \"Add&quot; to schedule one."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5461,5489],"text":"Click \"Add&ldquo; to schedule one."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5461,5489],"text":"Click \"Add&#34; to schedule one."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5461,5489],"text":"Click \"Add&rdquo; to schedule one."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { Plus, X, Loader2 } from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Button } from \"@/components/ui/Button\"\r\nimport { Input, Select } from \"@/components/ui/Input\"\r\nimport { EventCard } from \"./EventCard\"\r\nimport { createCalendarItem, CARE_RECEIVER_ID } from \"@/lib/api\"\r\nimport type { CalendarEvent, FamilyMember, EventCategory } from \"@/lib/calendar-types\"\r\nimport { CATEGORY_LABELS } from \"@/lib/calendar-types\"\r\nimport type { CalendarItemType } from \"@/lib/types\"\r\n\r\ninterface EventSidebarProps {\r\n  selectedDate: string\r\n  events: CalendarEvent[]\r\n  onAddEvent: (event: Omit<CalendarEvent, \"id\">) => void\r\n  onEventAdded?: () => void\r\n  onTriggerNow?: (eventId: string) => void\r\n  onDelete?: (eventId: string) => void\r\n  onClose?: () => void\r\n  isMobile?: boolean\r\n  triggeringId?: string | null\r\n  sendFeedback?: \"success\" | \"error\" | null\r\n}\r\n\r\nconst MEMBER_OPTIONS: { value: FamilyMember; label: string }[] = [\r\n  { value: \"mom\", label: \"Mom\" },\r\n  { value: \"dad\", label: \"Dad\" },\r\n  { value: \"doctor\", label: \"Doctor\" },\r\n  { value: \"family\", label: \"Family\" },\r\n]\r\n\r\nconst CATEGORY_OPTIONS: { value: EventCategory; label: string }[] = [\r\n  { value: \"medication\", label: CATEGORY_LABELS.medication },\r\n  { value: \"appointment\", label: CATEGORY_LABELS.appointment },\r\n  { value: \"visit\", label: CATEGORY_LABELS.visit },\r\n  { value: \"voice_message\", label: CATEGORY_LABELS.voice_message },\r\n  { value: \"shopping\", label: CATEGORY_LABELS.shopping },\r\n  { value: \"other\", label: CATEGORY_LABELS.other },\r\n]\r\n\r\nfunction formatSidebarDate(dateStr: string): string {\r\n  return new Date(dateStr + \"T12:00:00\").toLocaleDateString(\"en-GB\", {\r\n    weekday: \"long\",\r\n    day: \"numeric\",\r\n    month: \"long\",\r\n  })\r\n}\r\n\r\nexport function EventSidebar({\r\n  selectedDate,\r\n  events,\r\n  onAddEvent,\r\n  onEventAdded,\r\n  onTriggerNow,\r\n  onDelete,\r\n  onClose,\r\n  isMobile = false,\r\n  triggeringId = null,\r\n  sendFeedback = null,\r\n}: EventSidebarProps) {\r\n  const [showForm, setShowForm] = useState(false)\r\n  const [title, setTitle] = useState(\"\")\r\n  const [note, setNote] = useState(\"\")\r\n  const [time, setTime] = useState(\"09:00\")\r\n  const [category, setCategory] = useState<EventCategory>(\"appointment\")\r\n  const [member, setMember] = useState<FamilyMember>(\"family\")\r\n  const [submitting, setSubmitting] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    if (!title.trim()) return\r\n    setSubmitting(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const scheduledAt = new Date(`${selectedDate}T${time}:00`).toISOString()\r\n      const messageText = note.trim() ? `[${category}] ${note.trim()}` : `[${category}]`\r\n      const itemType: CalendarItemType =\r\n        category === \"voice_message\" ? \"audio_push\" : \"reminder\"\r\n\r\n      await createCalendarItem({\r\n        care_receiver_id: CARE_RECEIVER_ID,\r\n        type: itemType,\r\n        title: title.trim(),\r\n        message_text: messageText,\r\n        scheduled_at: scheduledAt,\r\n      })\r\n\r\n      onAddEvent({ title: title.trim(), note: note.trim() || undefined, date: selectedDate, time, category, member })\r\n      onEventAdded?.()\r\n\r\n      setTitle(\"\")\r\n      setNote(\"\")\r\n      setTime(\"09:00\")\r\n      setCategory(\"appointment\")\r\n      setMember(\"family\")\r\n      setShowForm(false)\r\n    } catch {\r\n      setError(\"Failed to add event. Please try again.\")\r\n    } finally {\r\n      setSubmitting(false)\r\n    }\r\n  }\r\n\r\n  const sortedEvents = [...events].sort((a, b) => a.time.localeCompare(b.time))\r\n\r\n  return (\r\n    <motion.aside\r\n      initial={isMobile ? { x: \"100%\" } : false}\r\n      animate={{ x: 0 }}\r\n      exit={isMobile ? { x: \"100%\" } : undefined}\r\n      className={cn(\r\n        \"flex flex-col border-l border-border bg-card\",\r\n        isMobile ? \"fixed inset-y-0 right-0 z-30 w-full max-w-md\" : \"w-80 shrink-0\",\r\n      )}\r\n      aria-label={`Events ÔÇö ${formatSidebarDate(selectedDate)}`}\r\n    >\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between border-b border-border px-4 py-3\">\r\n        <div>\r\n          <h2 className=\"text-sm font-semibold capitalize text-foreground\">\r\n            {formatSidebarDate(selectedDate)}\r\n          </h2>\r\n          <p className=\"text-xs text-muted-foreground\">\r\n            {sortedEvents.length === 0 ? \"No events\" : `${sortedEvents.length} event${sortedEvents.length > 1 ? \"s\" : \"\"}`}\r\n          </p>\r\n        </div>\r\n        {isMobile && onClose && (\r\n          <button\r\n            onClick={onClose}\r\n            className=\"flex h-[44px] w-[44px] items-center justify-center rounded-lg text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-[3px] focus:ring-primary/50\"\r\n            aria-label=\"Close\"\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto p-4\">\r\n        <AnimatePresence mode=\"popLayout\">\r\n          {sortedEvents.length === 0 && !showForm ? (\r\n            <motion.p\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              className=\"py-4 text-center text-sm text-muted-foreground\"\r\n            >\r\n              No events for this day.\r\n              <br />\r\n              <span className=\"text-xs\">Click \"Add\" to schedule one.</span>\r\n            </motion.p>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {sendFeedback === \"success\" && (\r\n                <p className=\"rounded-lg border border-primary/30 bg-primary/10 px-3 py-2 text-xs text-foreground\">\r\n                  Envoy├® au device.{\" \"}\r\n                  <a href=\"/device\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline\">\r\n                    Ouvrir Device view Ôåù\r\n                  </a>\r\n                </p>\r\n              )}\r\n              {sendFeedback === \"error\" && (\r\n                <p className=\"rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-xs text-destructive\">\r\n                  ├ëchec de l&apos;envoi. V├®rifiez le backend.\r\n                </p>\r\n              )}\r\n              {sortedEvents.map((event) => (\r\n                <EventCard\r\n                  key={event.id}\r\n                  event={event}\r\n                  onTriggerNow={onTriggerNow}\r\n                  onDelete={onDelete}\r\n                  isTriggering={triggeringId === event.id}\r\n                />\r\n              ))}\r\n            </div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {showForm ? (\r\n          <motion.form\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            exit={{ opacity: 0, height: 0 }}\r\n            onSubmit={handleSubmit}\r\n            className=\"mt-4 space-y-3 rounded-lg border border-border bg-muted/50 p-4\"\r\n          >\r\n            <h3 className=\"text-sm font-semibold text-foreground\">New Event</h3>\r\n\r\n            <Input\r\n              label=\"Title *\"\r\n              value={title}\r\n              onChange={(e) => setTitle(e.target.value)}\r\n              placeholder=\"e.g. Doctor visit\"\r\n              required\r\n            />\r\n\r\n            <Select\r\n              label=\"Category\"\r\n              options={CATEGORY_OPTIONS}\r\n              value={category}\r\n              onChange={(e) => setCategory(e.target.value as EventCategory)}\r\n            />\r\n\r\n            <Select\r\n              label=\"Person\"\r\n              options={MEMBER_OPTIONS}\r\n              value={member}\r\n              onChange={(e) => setMember(e.target.value as FamilyMember)}\r\n            />\r\n\r\n            <div>\r\n              <label className=\"mb-1 block text-sm font-medium text-foreground\">Time</label>\r\n              <input\r\n                type=\"time\"\r\n                value={time}\r\n                onChange={(e) => setTime(e.target.value)}\r\n                className=\"h-10 w-full rounded-lg border border-input px-3 py-2 text-sm text-foreground focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20\"\r\n              />\r\n            </div>\r\n\r\n            <Input\r\n              label=\"Note (optional)\"\r\n              value={note}\r\n              onChange={(e) => setNote(e.target.value)}\r\n              placeholder=\"Add a note...\"\r\n            />\r\n\r\n            {error && (\r\n              <p className=\"rounded-lg bg-destructive/10 px-3 py-2 text-xs text-destructive\">\r\n                {error}\r\n              </p>\r\n            )}\r\n\r\n            <div className=\"flex gap-2\">\r\n              <Button type=\"submit\" size=\"md\" disabled={submitting || !title.trim()}>\r\n                {submitting ? (\r\n                  <>\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" aria-hidden />\r\n                    AddingÔÇª\r\n                  </>\r\n                ) : (\r\n                  \"Add\"\r\n                )}\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                size=\"md\"\r\n                onClick={() => { setShowForm(false); setError(null) }}\r\n                disabled={submitting}\r\n              >\r\n                Cancel\r\n              </Button>\r\n            </div>\r\n          </motion.form>\r\n        ) : (\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"md\"\r\n            className=\"mt-4 w-full\"\r\n            onClick={() => setShowForm(true)}\r\n          >\r\n            <Plus className=\"h-4 w-4 shrink-0\" aria-hidden />\r\n            Add Event\r\n          </Button>\r\n        )}\r\n      </div>\r\n    </motion.aside>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\dashboard\\AudioContentCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\dashboard\\DashboardNav.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":6,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[164,174],"text":""},"desc":"Remove unused variable \"Settings\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport Link from \"next/link\"\r\nimport { usePathname } from \"next/navigation\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Home, Calendar, Brain, Music, Settings } from \"lucide-react\"\r\n\r\n// 4 main sections (Zero stress, lifeline)\r\nconst MAIN_NAV = [\r\n  {\r\n    label: \"Home\",\r\n    labelShort: \"Home\",\r\n    href: \"/dashboard\",\r\n    icon: Home,\r\n    description: \"Overview & reassurance\",\r\n  },\r\n  {\r\n    label: \"Calendar & Alerts\",\r\n    labelShort: \"Calendar\",\r\n    href: \"/dashboard/calendar\",\r\n    icon: Calendar,\r\n    description: \"Reminders, appointments, routines\",\r\n  },\r\n  {\r\n    label: \"Health & Stimulation\",\r\n    labelShort: \"Health\",\r\n    href: \"/dashboard/health\",\r\n    icon: Brain,\r\n    description: \"Games, cognitive follow-up\",\r\n  },\r\n  {\r\n    label: \"Media & Family\",\r\n    labelShort: \"Media\",\r\n    href: \"/dashboard/content\",\r\n    icon: Music,\r\n    description: \"Music, family messages\",\r\n  },\r\n]\r\n\r\nexport function DashboardNav() {\r\n  const pathname = usePathname()\r\n\r\n  const isActive = (href: string) =>\r\n    href === \"/dashboard\" ? pathname === \"/dashboard\" : pathname.startsWith(href)\r\n\r\n  return (\r\n    <nav className=\"flex flex-col gap-0.5 px-2\">\r\n      {MAIN_NAV.map((item) => {\r\n        const active = isActive(item.href)\r\n        const Icon = item.icon\r\n        return (\r\n          <Link\r\n            key={item.href}\r\n            href={item.href}\r\n            className={cn(\r\n              \"flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-colors\",\r\n              active\r\n                ? \"bg-muted text-primary\"\r\n                : \"text-muted-foreground hover:bg-muted hover:text-foreground\",\r\n            )}\r\n          >\r\n            <Icon className=\"h-4 w-4 shrink-0\" strokeWidth={2} aria-hidden />\r\n            <span className=\"hidden lg:inline\">{item.label}</span>\r\n          </Link>\r\n        )\r\n      })}\r\n    </nav>\r\n  )\r\n}\r\n\r\nexport function BottomNav() {\r\n  const pathname = usePathname()\r\n\r\n  const isActive = (href: string) =>\r\n    href === \"/dashboard\" ? pathname === \"/dashboard\" : pathname.startsWith(href)\r\n\r\n  return (\r\n    <nav\r\n      className=\"fixed bottom-0 left-0 right-0 z-40 flex items-center justify-around border-t border-border bg-background/95 py-3 backdrop-blur-sm md:hidden\"\r\n      aria-label=\"Main navigation\"\r\n    >\r\n      {MAIN_NAV.map((item) => {\r\n        const active = isActive(item.href)\r\n        const Icon = item.icon\r\n        return (\r\n          <Link\r\n            key={item.href}\r\n            href={item.href}\r\n            className={cn(\r\n              \"flex flex-col items-center justify-center gap-1 min-h-[56px] min-w-[56px] px-3 py-2 transition-colors rounded-lg\",\r\n              active ? \"text-primary font-medium\" : \"text-muted-foreground\",\r\n            )}\r\n            aria-current={active ? \"page\" : undefined}\r\n          >\r\n            <Icon className=\"h-5 w-5\" strokeWidth={2} aria-hidden />\r\n            <span className=\"text-xs\">{item.labelShort}</span>\r\n          </Link>\r\n        )\r\n      })}\r\n    </nav>\r\n  )\r\n}\r\n\r\nexport { MAIN_NAV }","usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\dashboard\\DemoPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\dashboard\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\device\\KioskShell.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'processAction'. Either include it or remove the dependency array.","line":249,"column":6,"nodeType":"ArrayExpression","endLine":249,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [actions, processAction, state]","fix":{"range":[8372,8388],"text":"[actions, processAction, state]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\SeniorCareCalendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\hooks\\useAudioContents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\hooks\\useCalendarItems.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\hooks\\useNextActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\hooks\\useTimeline.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\audio.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\calendar-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\mocks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\speech.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1999,2002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1999,2002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2102,2105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2102,2105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2934,2937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2934,2937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3669,3672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3669,3672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\GitHub_prog\\hack_europe\\frontend\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
